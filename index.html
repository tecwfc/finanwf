<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>FINANWF - Sistema Financeiro Responsivo</title>
    <!-- Favicon usando o logo da pasta assets -->
    <link rel="icon" type="image/png" href="assets/logo.png">
    <link rel="apple-touch-icon" href="assets/logo.png">
    <!-- MANIFEST E PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FinanWF">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/10149/10149458.png">
    <meta name="msapplication-TileColor" content="#84cc16">
    <meta name="theme-color" content="#1a1e26">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Fonte Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <style>
        /* RESET E ESTILOS BASE */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: #0f1217;
            color: #ffffff;
            font-size: 16px;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* CONTAINER RESPONSIVO */
        .container {
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            padding-left: clamp(0.75rem, 3vw, 2rem);
            padding-right: clamp(0.75rem, 3vw, 2rem);
        }

        @media (min-width: 640px) {
            .container {
                max-width: 640px;
            }
        }

        @media (min-width: 768px) {
            .container {
                max-width: 768px;
            }
        }

        @media (min-width: 1024px) {
            .container {
                max-width: 1024px;
            }
        }

        @media (min-width: 1280px) {
            .container {
                max-width: 1280px;
            }
        }

        @media (min-width: 1536px) {
            .container {
                max-width: 1536px;
            }
        }

        /* SCROLLBAR PERSONALIZADA */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1e26;
        }

        ::-webkit-scrollbar-thumb {
            background: #84cc16;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #4d7c0f;
        }

        /* ANIMA√á√ïES */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-20px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        /* BOT√ÉO PRINCIPAL */
        .btn-primary {
            background: linear-gradient(135deg, #84cc16 0%, #4d7c0f 100%);
            transition: all 0.3s;
            color: #ffffff;
            font-weight: 700;
            border: none;
            cursor: pointer;
            padding: clamp(0.75rem, 2vw, 1rem);
            font-size: clamp(0.875rem, 1.5vw, 1rem);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(132, 204, 22, 0.3);
        }

        /* BADGES */
        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: clamp(0.625rem, 1.5vw, 0.75rem);
            font-weight: 600;
            text-transform: uppercase;
            display: inline-block;
            white-space: nowrap;
        }

        .badge-success {
            background: #059669;
            color: #ffffff;
        }

        .badge-warning {
            background: #b45309;
            color: #ffffff;
        }

        .badge-info {
            background: #84cc16;
            color: #0f1217;
        }

        /* TABELAS RESPONSIVAS - MELHORADAS */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: 1rem;
            background: #1a1e26;
            width: 100%;
            margin: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 100%;
        }

        th {
            text-align: left;
            padding: clamp(0.5rem, 2vw, 1rem);
            font-size: clamp(0.625rem, 1.5vw, 0.75rem);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #84cc16;
            border-bottom: 2px solid #2a2f3a;
            background: #1a1e26;
            white-space: nowrap;
        }

        td {
            padding: clamp(0.5rem, 2vw, 1rem);
            border-bottom: 1px solid #2a2f3a;
            color: #ffffff;
            white-space: nowrap;
            font-size: clamp(0.7rem, 1.8vw, 0.875rem);
        }

        @media (max-width: 640px) {

            td,
            th {
                padding: 0.5rem 0.35rem;
            }

            td:first-child,
            th:first-child {
                padding-left: 0.5rem;
            }

            td:last-child,
            th:last-child {
                padding-right: 0.5rem;
            }
        }

        tr:hover {
            background: #2a2f3a;
        }

        /* CARDS RESPONSIVOS */
        .dashboard-card {
            background: #1a1e26;
            border-radius: clamp(1rem, 3vw, 1.5rem);
            padding: clamp(1rem, 3vw, 1.5rem);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            height: 100%;
        }

        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(132, 204, 22, 0.1);
        }

        /* LOGIN CARD */
        .login-card {
            background: #1a1e26;
            border-radius: clamp(1.5rem, 4vw, 2rem);
            padding: clamp(1.5rem, 5vw, 2.5rem);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* SIDEBAR DESKTOP */
        .sidebar-desktop {
            position: sticky;
            top: 1rem;
            background: #1a1e26;
            border-radius: 1.5rem;
            padding: 1.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            transition: all 0.2s;
            color: #94a3b8;
            font-weight: 500;
            width: 100%;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: clamp(0.875rem, 1.5vw, 1rem);
            min-height: 44px;
        }

        .sidebar-item:hover {
            background: #2a2f3a;
            color: #84cc16;
        }

        .sidebar-item.active {
            background: #84cc16;
            color: #0f1217 !important;
        }

        /* ===== MENU INFERIOR MOBILE - CORRIGIDO - ABSOLUTAMENTE FIXO ===== */
        .mobile-bottom-nav {
            display: none;
            position: fixed !important;
            /* For√ßar fixed */
            bottom: 0 !important;
            left: 0 !important;
            right: 0 !important;
            background: #1a1e26;
            border-top: 2px solid #84cc16;
            padding: 0.35rem 0.15rem;
            z-index: 999999 !important;
            /* Z-index extremamente alto */
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            height: auto;
            min-height: 65px;
            width: 100%;
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
            margin: 0 !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        @media (max-width: 768px) {
            .mobile-bottom-nav {
                display: flex !important;
                flex-wrap: nowrap;
                justify-content: space-around;
                align-items: center;
            }

            body {
                padding-bottom: 70px !important;
            }

            #app {
                padding-bottom: 0;
                min-height: calc(100vh - 70px);
            }

            /* Garantir que nenhum elemento sobreponha o menu */
            .container.mx-auto {
                padding-bottom: 10px;
            }

            /* Ajustar o conte√∫do principal */
            main {
                margin-bottom: 0 !important;
                padding-bottom: 20px !important;
            }
        }

        .mobile-bottom-nav-item {
            flex: 1 1 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.4rem 0.1rem;
            border-radius: 0.75rem;
            font-size: clamp(0.55rem, 2vw, 0.7rem);
            color: #94a3b8;
            transition: all 0.2s;
            gap: 0.1rem;
            background: transparent;
            border: none;
            cursor: pointer;
            min-height: 50px;
            min-width: 44px;
            position: relative;
            text-align: center;
        }

        .mobile-bottom-nav-item i {
            font-size: clamp(1rem, 5vw, 1.3rem);
            margin-bottom: 2px;
        }

        .mobile-bottom-nav-item span {
            font-size: clamp(0.5rem, 2vw, 0.65rem);
            line-height: 1.2;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding: 0 2px;
        }

        .mobile-bottom-nav-item.active {
            color: #84cc16;
            background: #2a2f3a;
            font-weight: 600;
        }

        .mobile-bottom-nav-item:active {
            transform: scale(0.95);
        }

        /* BADGE DO MENU - AJUSTADO */
        #qtdPendentesNav {
            position: absolute;
            top: 2px;
            right: 15px;
            background: #84cc16;
            color: #0f1217;
            font-size: 0.6rem;
            font-weight: bold;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
            z-index: 10000;
        }

        @media (max-width: 480px) {
            .mobile-bottom-nav-item i {
                font-size: 1.1rem;
            }

            .mobile-bottom-nav-item span {
                font-size: 0.5rem;
            }

            #qtdPendentesNav {
                right: 8px;
                top: 0px;
                min-width: 16px;
                height: 16px;
                font-size: 0.5rem;
            }
        }

        @media (max-width: 360px) {
            .mobile-bottom-nav {
                padding: 0.2rem 0;
                min-height: 60px;
            }

            .mobile-bottom-nav-item {
                padding: 0.2rem 0;
            }

            .mobile-bottom-nav-item i {
                font-size: 1rem;
            }

            .mobile-bottom-nav-item span {
                font-size: 0.45rem;
            }
        }

        /* CAMPOS DE SENHA */
        .password-container {
            position: relative;
            width: 100%;
        }

        .password-container input {
            padding-right: 3rem !important;
            width: 100%;
        }

        .password-toggle {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #84cc16;
            cursor: pointer;
            padding: 0.5rem;
            font-size: 1.2rem;
            z-index: 10;
            min-width: 44px;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* INPUTS E SELECTS - TAMANHOS AJUSTADOS */
        input,
        select,
        textarea {
            background: #0f1217 !important;
            border: 2px solid #2a2f3a !important;
            color: #ffffff !important;
            border-radius: 0.75rem;
            padding: clamp(0.5rem, 2vw, 0.75rem) clamp(0.75rem, 2vw, 1rem);
            font-size: clamp(0.875rem, 2vw, 1rem);
            width: 100%;
            transition: all 0.2s;
        }

        @media (max-width: 640px) {

            input,
            select,
            textarea {
                padding: 0.6rem 0.75rem;
                font-size: 16px;
                /* Evita zoom no iOS */
            }
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: #84cc16 !important;
            outline: none;
            box-shadow: 0 0 0 3px rgba(132, 204, 22, 0.2);
        }

        /* GRIDS RESPONSIVOS */
        .responsive-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: clamp(0.75rem, 2vw, 1.5rem);
        }

        /* BOT√ïES COM √ÅREA DE TOQUE */
        .touch-button {
            min-height: 44px;
            min-width: 44px;
        }

        /* ICONES CIRCULARES */
        .icon-circle {
            width: clamp(2rem, 5vw, 2.5rem);
            height: clamp(2rem, 5vw, 2.5rem);
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #2a2f3a;
        }

        .icon-circle i {
            font-size: clamp(0.875rem, 2vw, 1rem);
        }

        /* PROGRESS BAR */
        .progress-bar {
            height: 0.5rem;
            background: #2a2f3a;
            border-radius: 9999px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #84cc16, #4d7c0f);
            border-radius: 9999px;
            transition: width 0.3s ease;
        }

        /* MODAIS RESPONSIVOS */
        .modal-content {
            background: #1a1e26;
            border-radius: clamp(1.5rem, 4vw, 2rem);
            padding: clamp(1.5rem, 4vw, 2rem);
            max-width: 500px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* GRAFICOS */
        canvas {
            max-width: 100%;
            height: auto !important;
        }

        .chart-container {
            position: relative;
            width: 100%;
            height: clamp(200px, 40vw, 300px);
        }

        /* TAB CONTENT */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        /* MEDIA QUERIES PARA TV */
        @media (min-width: 1920px) {
            html {
                font-size: 18px;
            }

            .container {
                max-width: 1800px;
            }

            .dashboard-card {
                padding: 2rem;
            }

            h1 {
                font-size: 3rem;
            }

            h2 {
                font-size: 2.5rem;
            }

            .badge {
                font-size: 0.875rem;
                padding: 0.375rem 1rem;
            }
        }

        @media (min-width: 2560px) {
            html {
                font-size: 20px;
            }

            .container {
                max-width: 2400px;
            }
        }

        /* UTILIT√ÅRIOS DE ESPA√áAMENTO */
        .gap-responsive {
            gap: clamp(0.5rem, 2vw, 1.5rem);
        }

        .p-responsive {
            padding: clamp(0.75rem, 3vw, 2rem);
        }

        .text-responsive {
            font-size: clamp(0.875rem, 2vw, 1.125rem);
        }

        /* BOT√ïES DE A√á√ÉO EM TABELAS */
        .action-button {
            background: #84cc16;
            color: #0f1217;
            padding: 0.3rem 0.6rem;
            border-radius: 0.5rem;
            font-size: clamp(0.6rem, 1.5vw, 0.7rem);
            font-weight: 600;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            min-height: 36px;
            min-width: 44px;
        }

        .action-button:hover {
            background: #4d7c0f;
            color: #ffffff;
        }

        @media (max-width: 640px) {
            .action-button {
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
            }
        }

        /* CORES DOS GR√ÅFICOS */
        .text-primary {
            color: #ffffff;
        }

        .text-secondary {
            color: #84cc16;
        }

        .bg-primary {
            background: #1a1e26;
        }

        .bg-secondary {
            background: #84cc16;
        }

        .border-secondary {
            border-color: #84cc16;
        }

        /* AJUSTES PARA A TELA DE LAN√áAMENTO */
        @media (max-width: 480px) {
            .grid-cols-1.sm\:grid-cols-2 {
                gap: 0.5rem;
            }

            .text-xl {
                font-size: 1.25rem;
            }

            .p-4 {
                padding: 0.75rem;
            }

            .mb-4 {
                margin-bottom: 0.75rem;
            }

            label {
                font-size: 0.7rem !important;
            }
        }

        /* CLASSES PARA ESCONDER EM MOBILE */
        @media (max-width: 640px) {

            .hide-mobile,
            .hide-on-mobile {
                display: none;
            }
        }

        /* MELHORIAS DE TOQUE PARA MOBILE */
        @media (max-width: 768px) {

            button,
            .touch-button,
            .mobile-bottom-nav-item,
            .sidebar-item,
            .action-button {
                min-height: 48px;
                min-width: 48px;
                touch-action: manipulation;
            }

            input,
            select,
            textarea {
                font-size: 16px !important;
                /* Evita zoom autom√°tico no iOS */
            }

            .table-container {
                margin-left: -0.5rem;
                margin-right: -0.5rem;
                width: calc(100% + 1rem);
                border-radius: 0.5rem;
            }
        }

        /* AJUSTES PARA TELAS MUITO PEQUENAS */
        @media (max-width: 360px) {
            .dashboard-card .value {
                font-size: 1rem;
            }

            .badge {
                font-size: 0.55rem;
                padding: 0.1rem 0.4rem;
            }

            th,
            td {
                padding: 0.4rem 0.2rem;
                font-size: 0.65rem;
            }
        }

        /* ANIMA√á√ïES SUAVES */
        * {
            transition: all 0.2s ease-in-out;
        }

        /* AJUSTES PARA IMPRESS√ÉO */
        @media print {

            .mobile-bottom-nav,
            header,
            button,
            .btn-primary,
            .action-button {
                display: none !important;
            }

            body,
            .bg-\[\#0f1217\],
            .bg-\[\#1a1e26\] {
                background-color: white !important;
                color: black !important;
            }

            .text-white,
            .text-\[\#84cc16\] {
                color: black !important;
            }
        }

        /* GARANTIR QUE O CONTE√öDO N√ÉO FIQUE ATR√ÅS DO MENU */
        .content-wrapper {
            padding-bottom: 10px;
        }

        /* AJUSTE PARA O BADGE NO SIDEBAR */
        #qtdPendentes {
            margin-left: auto;
            background: #84cc16;
            color: #0f1217;
            padding: 0.2rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        /* Anima√ß√µes e efeitos para o logo */
.logo-container {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.logo-image {
    transition: all 0.3s ease;
    filter: drop-shadow(0 4px 6px rgba(132, 204, 22, 0.2));
}

.logo-image:hover {
    transform: scale(1.05);
    filter: drop-shadow(0 6px 8px rgba(132, 204, 22, 0.4));
}

/* Fallback se a imagem n√£o carregar */
.logo-image.error {
    display: none;
}

.logo-fallback {
    display: none;
    font-size: 1.5rem;
    font-weight: bold;
    color: #84cc16;
}

.logo-image.error + .logo-fallback {
    display: block;
}
    </style>
</head>

<body class="bg-[#0f1217]">

    <!-- ============================================ -->
    <!-- TELA DE LOGIN COM OP√á√ÉO DE VER SENHA -->
    <!-- ============================================ -->
    <div id="telaLogin" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md slide-in">
            <div class="login-card">
                <div class="text-center mb-8">
                    <div class="flex items-center justify-center gap-3 mb-4">
                        <img src="assets/logo_finaceiro.png" alt="FinanWF Logo"
                            class="w-12 h-12 sm:w-16 sm:h-16 object-contain">
                        <h1 class="text-4xl sm:text-5xl font-black">
                            <span class="text-white">FINAN</span><span class="text-[#84cc16]">WF</span>
                        </h1>
                    </div>
                    <p class="text-sm sm:text-base text-slate-400">Sistema Financeiro Responsivo</p>
                </div>

                <div class="space-y-4 sm:space-y-6">
                    <div>
                        <label class="block text-xs sm:text-sm font-bold mb-2 text-slate-400">
                            <i class="fas fa-user mr-1 text-[#84cc16]"></i> USU√ÅRIO
                        </label>
                        <input type="text" id="inputUsuario"
                            class="w-full border-2 border-slate-700 rounded-xl p-3 sm:p-4 text-sm sm:text-base focus:border-[#84cc16] focus:ring-2 focus:ring-[#84cc16]/20 transition touch-button"
                            placeholder="Digite seu usu√°rio">
                    </div>

                    <div>
                        <label class="block text-xs sm:text-sm font-bold mb-2 text-slate-400">
                            <i class="fas fa-lock mr-1 text-[#84cc16]"></i> SENHA
                        </label>
                        <div class="password-container">
                            <input type="password" id="inputSenha"
                                class="w-full border-2 border-slate-700 rounded-xl p-3 sm:p-4 text-sm sm:text-base focus:border-[#84cc16] focus:ring-2 focus:ring-[#84cc16]/20 transition touch-button"
                                placeholder="Digite sua senha">
                            <button type="button" onclick="toggleSenha()" class="password-toggle" id="toggleSenhaBtn">
                                <i class="fa-regular fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <button onclick="verificarSenha()"
                        class="w-full btn-primary text-white font-bold py-3 sm:py-4 rounded-xl hover:opacity-90 transition touch-button text-sm sm:text-base mt-4">
                        <i class="fas fa-sign-in-alt mr-2"></i>
                        Entrar no Sistema
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- APLICA√á√ÉO PRINCIPAL -->
    <!-- ============================================ -->
    <div id="app" class="hidden min-h-screen md:pb-0">

        <!-- Header -->
        <header class="bg-[#1a1e26]/80 backdrop-blur-lg border-b border-slate-800 sticky top-0 z-10">
            <div class="container mx-auto px-4 py-3 sm:py-4 flex justify-between items-center">
                <div class="flex items-center gap-2 sm:gap-3">
                    <div class="flex items-center gap-2">
                        <img src="assets/logo_finaceiro.png" alt="FinanWF Logo"
                            class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 object-contain">
                        <span class="text-xl sm:text-2xl md:text-3xl font-black">
                            <span class="text-white">FINAN</span><span class="text-[#84cc16]">WF</span>
                        </span>
                    </div>
                </div>

                <div class="flex items-center gap-2 sm:gap-3">
                    <div class="flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-1.5 sm:py-2 bg-[#2a2f3a] rounded-xl">
                        <i class="fas fa-user-circle text-[#84cc16] text-sm sm:text-base"></i>
                        <span id="nomeUsuarioLogado" class="text-xs sm:text-sm font-bold text-white"></span>
                    </div>

                    <button onclick="fazerLogout()"
                        class="p-2 sm:p-2.5 rounded-xl hover:bg-rose-500/10 text-rose-400 transition touch-button">
                        <i class="fas fa-sign-out-alt text-sm sm:text-base"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="container mx-auto px-4 py-4 sm:py-6 md:py-8">
            <div class="flex flex-col md:flex-row gap-4 md:gap-6">
                <!-- Sidebar Desktop -->
                <aside class="hidden md:block md:w-64 lg:w-72 xl:w-80 flex-shrink-0">
                    <div class="sidebar-desktop">
                        <div class="space-y-1">
                            <button onclick="mudarTab('dash', this)" class="sidebar-item active w-full">
                                <i class="fas fa-chart-pie w-5"></i>
                                <span>Dashboard</span>
                            </button>

                            <button onclick="mudarTab('lancar', this)" class="sidebar-item w-full">
                                <i class="fas fa-plus-circle w-5"></i>
                                <span>Lan√ßar Conta</span>
                            </button>

                            <button onclick="mudarTab('vencimentos', this)" class="sidebar-item w-full">
                                <i class="fas fa-clock w-5"></i>
                                <span>Vencimentos</span>
                                <span id="qtdPendentes"
                                    class="ml-auto text-xs bg-[#84cc16] text-[#0f1217] px-2 py-1 rounded-full">0</span>
                            </button>

                            <button onclick="mudarTab('historico', this)" class="sidebar-item w-full">
                                <i class="fas fa-history w-5"></i>
                                <span>Hist√≥rico</span>
                            </button>

                            <button onclick="mudarTab('cartao', this)" class="sidebar-item w-full">
                                <i class="fas fa-credit-card w-5"></i>
                                <span>Cart√£o</span>
                            </button>

                            <button onclick="mudarTab('configuracoes', this)" class="sidebar-item w-full">
                                <i class="fas fa-cog w-5"></i>
                                <span>Configura√ß√µes</span>
                            </button>
                        </div>
                    </div>
                </aside>

                <!-- Content Area -->
                <main class="flex-1 min-w-0">

                    <!-- ===== DASHBOARD ===== -->
                    <div id="tab-dash" class="tab-content active fade-in">
                        <!-- Cards -->
                        <div class="grid grid-cols-1 xs:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6">
                            <div class="dashboard-card">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-xs sm:text-sm text-slate-400">Saldo</span>
                                    <div class="icon-circle">
                                        <i class="fas fa-wallet text-[#84cc16] text-sm sm:text-base"></i>
                                    </div>
                                </div>
                                <div id="cardSaldoRestante"
                                    class="text-lg sm:text-xl lg:text-2xl font-black text-white">R$ 0,00</div>
                            </div>

                            <div class="dashboard-card">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-xs sm:text-sm text-slate-400">Pendente</span>
                                    <div class="icon-circle">
                                        <i class="fas fa-clock text-[#84cc16] text-sm sm:text-base"></i>
                                    </div>
                                </div>
                                <div id="cardPendente" class="text-lg sm:text-xl lg:text-2xl font-black text-[#84cc16]">
                                    R$ 0,00</div>
                            </div>

                            <div class="dashboard-card">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-xs sm:text-sm text-slate-400">Pago</span>
                                    <div class="icon-circle">
                                        <i class="fas fa-check-circle text-[#84cc16] text-sm sm:text-base"></i>
                                    </div>
                                </div>
                                <div id="cardPago" class="text-lg sm:text-xl lg:text-2xl font-black text-[#84cc16]">R$
                                    0,00</div>
                            </div>

                            <div class="dashboard-card">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-xs sm:text-sm text-slate-400">Receitas</span>
                                    <div class="icon-circle">
                                        <i class="fas fa-arrow-up text-[#84cc16] text-sm sm:text-base"></i>
                                    </div>
                                </div>
                                <div id="cardReceitas" class="text-lg sm:text-xl lg:text-2xl font-black text-[#84cc16]">
                                    R$ 0,00</div>
                            </div>
                        </div>

                        <!-- Barra de Progresso -->
                        <div class="bg-[#1a1e26] rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-lg mb-4 sm:mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-bold text-sm sm:text-base text-white">Progresso do M√™s</h3>
                                <span id="txtPorcentagem"
                                    class="text-[#84cc16] font-bold text-sm sm:text-base">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div id="barraProgresso" class="progress-bar-fill" style="width: 0%"></div>
                            </div>
                        </div>

                        <!-- Gr√°ficos -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
                            <div class="bg-[#1a1e26] rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-lg">
                                <h3 class="font-bold text-sm sm:text-base text-white mb-4">üìä Gastos por Categoria</h3>
                                <div class="chart-container">
                                    <canvas id="graficoPizza"></canvas>
                                </div>
                            </div>

                            <div class="bg-[#1a1e26] rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-lg">
                                <h3 class="font-bold text-sm sm:text-base text-white mb-4">üìà Evolu√ß√£o Mensal</h3>
                                <div class="chart-container">
                                    <canvas id="graficoBarras"></canvas>
                                </div>
                            </div>

                            <div class="bg-[#1a1e26] rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-lg lg:col-span-2">
                                <h3 class="font-bold text-sm sm:text-base text-white mb-4">üí≥ Formas de Pagamento</h3>
                                <div class="chart-container">
                                    <canvas id="graficoFormasPagamento"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ===== LAN√áAR CONTA ===== -->
                    <div id="tab-lancar" class="tab-content fade-in">
                        <div class="bg-[#1a1e26] rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-lg">
                            <h2 class="text-xl sm:text-2xl font-black text-white mb-4 sm:mb-6">üìù Lan√ßar Nova Conta</h2>

                            <form onsubmit="event.preventDefault(); lancar()" class="space-y-3 sm:space-y-4">
                                <input type="hidden" id="editId" value="">

                                <div>
                                    <label
                                        class="block text-xs sm:text-sm font-bold mb-1 sm:mb-2 text-slate-400">DESCRI√á√ÉO</label>
                                    <input type="text" id="desc"
                                        class="w-full border-2 border-slate-700 rounded-xl p-3 sm:p-4 text-sm sm:text-base focus:border-[#84cc16] focus:ring-2 focus:ring-[#84cc16]/20 transition touch-button"
                                        placeholder="Ex: Compra no mercado" required>
                                </div>

                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                                    <div>
                                        <label
                                            class="block text-xs sm:text-sm font-bold mb-1 sm:mb-2 text-slate-400">VALOR
                                            (R$)</label>
                                        <input type="number" id="valor" step="0.01" min="0.01"
                                            class="w-full border-2 border-slate-700 rounded-xl p-3 sm:p-4 text-sm sm:text-base focus:border-[#84cc16] focus:ring-2 focus:ring-[#84cc16]/20 transition touch-button"
                                            placeholder="0,00" required>
                                    </div>

                                    <div>
                                        <label
                                            class="block text-xs sm:text-sm font-bold mb-1 sm:mb-2 text-slate-400">CATEGORIA</label>
                                        <select id="categoria"
                                            class="w-full border-2 border-slate-700 rounded-xl p-3 sm:p-4 text-sm sm:text-base focus:border-[#84cc16] focus:ring-2 focus:ring-[#84cc16]/20 transition touch-button">
                                            <option value="Aluguel/Fixo">Aluguel/Fixo</option>
                                            <option value="Mercado">Mercado</option>
                                            <option value="Lazer">Lazer</option>
                                            <option value="Sa√∫de">Sa√∫de</option>
                                            <option value="Educa√ß√£o">Educa√ß√£o</option>
                                            <option value="Outros">Outros</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                                    <div>
                                        <label
                                            class="block text-xs sm:text-sm font-bold mb-1 sm:mb-2 text-slate-400">DATA</label>
                                        <input type="date" id="data"
                                            class="w-full border-2 border-slate-700 rounded-xl p-3 sm:p-4 text-sm sm:text-base focus:border-[#84cc16] focus:ring-2 focus:ring-[#84cc16]/20 transition touch-button"
                                            required>
                                    </div>

                                    <div>
                                        <label
                                            class="block text-xs sm:text-sm font-bold mb-1 sm:mb-2 text-slate-400">PAGAMENTO</label>
                                        <select id="formaPagamento" onchange="toggleCamposCartao()"
                                            class="w-full border-2 border-slate-700 rounded-xl p-3 sm:p-4 text-sm sm:text-base focus:border-[#84cc16] focus:ring-2 focus:ring-[#84cc16]/20 transition touch-button">
                                            <option value="Cart√£o de Cr√©dito">Cart√£o de Cr√©dito</option>
                                            <option value="Cart√£o de D√©bito">Cart√£o de D√©bito</option>
                                            <option value="Dinheiro">Dinheiro</option>
                                            <option value="PIX">PIX</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                                    <div>
                                        <label
                                            class="block text-xs sm:text-sm font-bold mb-1 sm:mb-2 text-slate-400">PARCELAS</label>
                                        <input type="number" id="parcelas" min="1" max="48" value="1"
                                            class="w-full border-2 border-slate-700 rounded-xl p-3 sm:p-4 text-sm sm:text-base focus:border-[#84cc16] focus:ring-2 focus:ring-[#84cc16]/20 transition touch-button"
                                            onchange="atualizarInfoCartao()">
                                    </div>

                                    <div id="divCartaoInfo" style="display: none;">
                                        <label
                                            class="block text-xs sm:text-sm font-bold mb-1 sm:mb-2 text-slate-400">CART√ÉO</label>
                                        <select id="cartaoSelecionado" onchange="atualizarInfoCartao()"
                                            class="w-full border-2 border-slate-700 rounded-xl p-3 sm:p-4 text-sm sm:text-base focus:border-[#84cc16] focus:ring-2 focus:ring-[#84cc16]/20 transition touch-button">
                                        </select>
                                    </div>
                                </div>

                                <div id="infoFaturaAtual" class="mt-4"></div>

                                <button type="submit" id="btnLancar"
                                    class="w-full btn-primary text-white font-bold py-3 sm:py-4 rounded-xl hover:opacity-90 transition touch-button text-sm sm:text-base mt-4">
                                    <i class="fas fa-check-circle mr-2"></i>
                                    Confirmar Lan√ßamento
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- ===== VENCIMENTOS ===== -->
                    <div id="tab-vencimentos" class="tab-content fade-in">
                        <div class="bg-[#1a1e26] rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-lg">
                            <div
                                class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4 mb-4 sm:mb-6">
                                <h2 class="text-xl sm:text-2xl font-black text-white">‚è∞ Contas a Pagar</h2>
                                <button onclick="abrirModalPDF('vencimentos')"
                                    class="w-full sm:w-auto px-4 py-2 sm:px-6 sm:py-3 bg-[#2a2f3a] text-[#84cc16] rounded-xl hover:bg-[#84cc16] hover:text-[#0f1217] transition touch-button flex items-center gap-2 justify-center text-sm sm:text-base">
                                    <i class="fas fa-file-pdf"></i>
                                    Gerar PDF
                                </button>
                            </div>

                            <!-- Barra de Progresso -->
                            <div class="mb-4 sm:mb-6 p-3 sm:p-4 bg-[#2a2f3a] rounded-xl">
                                <div class="flex justify-between text-xs sm:text-sm mb-2">
                                    <span class="font-medium text-white">üí∞ <span id="totalPendenteMes">R$
                                            0,00</span></span>
                                    <span class="text-[#84cc16] font-bold"><span id="porcentagemPagaMes">0%</span> do
                                        or√ßamento</span>
                                </div>
                                <div class="progress-bar">
                                    <div id="barraProgressoVencimentos" class="progress-bar-fill" style="width: 0%">
                                    </div>
                                </div>
                            </div>

                            <!-- Tabela -->
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th class="text-xs">PARC</th>
                                            <th class="text-xs">DESCRI√á√ÉO</th>
                                            <th class="text-xs hide-mobile">PAGAMENTO</th>
                                            <th class="text-xs">CATEGORIA</th>
                                            <th class="text-xs">VENC</th>
                                            <th class="text-xs text-right">VALOR</th>
                                            <th class="text-xs text-center">A√á√ÉO</th>
                                        </tr>
                                    </thead>
                                    <tbody id="corpoTabelaVencimentos">
                                        <tr>
                                            <td colspan="7" class="text-center py-8 text-slate-400 text-sm">
                                                Carregando...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- ===== HIST√ìRICO ===== -->
                    <div id="tab-historico" class="tab-content fade-in">
                        <div class="bg-[#1a1e26] rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-lg">
                            <div
                                class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4 mb-4 sm:mb-6">
                                <h2 class="text-xl sm:text-2xl font-black text-white">üìú Hist√≥rico</h2>
                                <button onclick="abrirModalPDF('historico')"
                                    class="w-full sm:w-auto px-4 py-2 sm:px-6 sm:py-3 bg-[#2a2f3a] text-[#84cc16] rounded-xl hover:bg-[#84cc16] hover:text-[#0f1217] transition touch-button flex items-center gap-2 justify-center text-sm sm:text-base">
                                    <i class="fas fa-file-pdf"></i>
                                    Gerar PDF
                                </button>
                            </div>

                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th class="text-xs">PARC</th>
                                            <th class="text-xs">DESCRI√á√ÉO</th>
                                            <th class="text-xs hide-mobile">PAGAMENTO</th>
                                            <th class="text-xs">CATEGORIA</th>
                                            <th class="text-xs">DATA</th>
                                            <th class="text-xs text-right">VALOR</th>
                                            <th class="text-xs text-center">A√á√ÉO</th>
                                        </tr>
                                    </thead>
                                    <tbody id="corpoTabelaPagos">
                                        <tr>
                                            <td colspan="7" class="text-center py-8 text-slate-400 text-sm">
                                                Carregando...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- ===== CART√ÉO ===== -->
                    <div id="tab-cartao" class="tab-content fade-in">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
                            <div class="lg:col-span-2 bg-[#1a1e26] rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-lg">
                                <div class="flex justify-between items-center mb-4 sm:mb-6">
                                    <h2 class="text-xl sm:text-2xl font-black text-white">üí≥ Faturas</h2>
                                    <button onclick="abrirModalPDF('cartao')"
                                        class="p-2 sm:p-3 bg-[#2a2f3a] text-[#84cc16] rounded-xl hover:bg-[#84cc16] hover:text-[#0f1217] transition touch-button">
                                        <i class="fas fa-file-pdf text-sm sm:text-base"></i>
                                    </button>
                                </div>
                                <div id="containerFaturas" class="space-y-3"></div>
                            </div>

                            <div class="bg-[#1a1e26] rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-lg">
                                <h2 class="text-lg sm:text-xl font-black text-white mb-4">üìä Resumo</h2>
                                <div id="containerResumoCartoes" class="space-y-2"></div>

                                <div class="mt-4 sm:mt-6 pt-4 border-t border-slate-700">
                                    <button onclick="abrirModalPagamentoFatura()"
                                        class="w-full btn-primary text-white py-3 sm:py-4 rounded-xl font-bold hover:opacity-90 transition touch-button text-sm sm:text-base">
                                        <i class="fas fa-credit-card mr-2"></i>
                                        Pagar Fatura
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="bg-[#1a1e26] rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-lg mt-4 sm:mt-6">
                            <h2 class="text-lg sm:text-xl font-black text-white mb-4">üìã Compras no Cart√£o</h2>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th class="text-xs">DESCRI√á√ÉO</th>
                                            <th class="text-xs hide-mobile">CART√ÉO</th>
                                            <th class="text-xs">PARC</th>
                                            <th class="text-xs hide-mobile">DATA</th>
                                            <th class="text-xs text-right">VALOR</th>
                                            <th class="text-xs text-center">STATUS</th>
                                        </tr>
                                    </thead>
                                    <tbody id="corpoTabelaCartao"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- ===== CONFIGURA√á√ïES ===== -->
                    <div id="tab-configuracoes" class="tab-content fade-in">
                        <div class="bg-[#1a1e26] rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-lg">
                            <h2 class="text-xl sm:text-2xl font-black text-white mb-4 sm:mb-6">‚öôÔ∏è Configura√ß√µes</h2>

                            <form onsubmit="salvarConfiguracoes(event)" class="space-y-4 sm:space-y-6">
                                <div>
                                    <label
                                        class="block text-xs sm:text-sm font-bold mb-1 sm:mb-2 text-slate-400">SAL√ÅRIO /
                                        RENDA</label>
                                    <input type="number" id="inputSalario" step="100" value="4000"
                                        class="w-full border-2 border-slate-700 rounded-xl p-3 sm:p-4 text-sm sm:text-base focus:border-[#84cc16] focus:ring-2 focus:ring-[#84cc16]/20 transition touch-button">
                                </div>

                                <div>
                                    <label
                                        class="block text-xs sm:text-sm font-bold mb-2 sm:mb-4 text-slate-400">CART√ïES</label>
                                    <div id="containerCartoesConfig" class="space-y-3"></div>

                                    <button type="button" onclick="adicionarCartaoConfig()"
                                        class="mt-3 sm:mt-4 text-[#84cc16] text-xs sm:text-sm font-bold hover:text-[#4d7c0f] transition touch-button flex items-center gap-2">
                                        <i class="fas fa-plus-circle"></i>
                                        Adicionar Cart√£o
                                    </button>
                                </div>

                                <button type="submit"
                                    class="w-full btn-primary text-white font-bold py-3 sm:py-4 rounded-xl hover:opacity-90 transition touch-button text-sm sm:text-base">
                                    <i class="fas fa-save mr-2"></i>
                                    Salvar Configura√ß√µes
                                </button>
                            </form>
                        </div>
                    </div>

                </main>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- NAVEGA√á√ÉO INFERIOR (MOBILE) - CORRIGIDA - FIXA E N√ÉO SOME -->
    <!-- ============================================ -->
    <div class="mobile-bottom-nav">
        <button onclick="mudarTabMobile('dash')" class="mobile-bottom-nav-item active" data-tab="dash">
            <i class="fas fa-chart-pie"></i>
            <span>In√≠cio</span>
        </button>
        <button onclick="mudarTabMobile('lancar')" class="mobile-bottom-nav-item" data-tab="lancar">
            <i class="fas fa-plus-circle"></i>
            <span>Lan√ßar</span>
        </button>
        <button onclick="mudarTabMobile('vencimentos')" class="mobile-bottom-nav-item" data-tab="vencimentos">
            <i class="fas fa-clock"></i>
            <span>Contas</span>
            <span id="qtdPendentesNav"
                class="absolute top-0 right-1 text-xs bg-[#84cc16] text-[#0f1217] px-1.5 py-0.5 rounded-full">0</span>
        </button>
        <button onclick="mudarTabMobile('historico')" class="mobile-bottom-nav-item" data-tab="historico">
            <i class="fas fa-history"></i>
            <span>Hist√≥rico</span>
        </button>
        <button onclick="mudarTabMobile('cartao')" class="mobile-bottom-nav-item" data-tab="cartao">
            <i class="fas fa-credit-card"></i>
            <span>Cart√£o</span>
        </button>
        <button onclick="mudarTabMobile('configuracoes')" class="mobile-bottom-nav-item" data-tab="configuracoes">
            <i class="fas fa-cog"></i>
            <span>Config</span>
        </button>
    </div>

    <!-- ============================================ -->
    <!-- MODAL PAGAMENTO DE FATURA -->
    <!-- ============================================ -->
    <div id="modalPagamentoFatura" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50 p-4">
        <div class="modal-content">
            <h3 class="text-lg sm:text-xl font-black text-white mb-4">üí≥ Pagar Fatura</h3>

            <div class="mb-4">
                <label class="block text-xs sm:text-sm font-bold mb-2 text-slate-400">SELECIONE A FATURA</label>
                <select id="selectFaturaModal"
                    class="w-full border-2 border-slate-700 rounded-xl p-3 text-sm sm:text-base focus:border-[#84cc16] focus:ring-2 focus:ring-[#84cc16]/20 transition touch-button">
                    <option>Carregando...</option>
                </select>
            </div>

            <div class="mb-4">
                <label class="block text-xs sm:text-sm font-bold mb-2 text-slate-400">VALOR A PAGAR</label>
                <input type="text" id="valorFaturaModal" readonly
                    class="w-full border-2 border-slate-700 rounded-xl p-3 text-sm sm:text-base bg-[#0f1217] text-white">
            </div>

            <div class="mb-6">
                <label class="block text-xs sm:text-sm font-bold mb-2 text-slate-400">DATA DE PAGAMENTO</label>
                <input type="date" id="modalDataPagamento"
                    class="w-full border-2 border-slate-700 rounded-xl p-3 text-sm sm:text-base focus:border-[#84cc16] focus:ring-2 focus:ring-[#84cc16]/20 transition touch-button">
            </div>

            <div class="flex flex-col sm:flex-row gap-3">
                <button onclick="fecharModalPagamentoFatura()"
                    class="flex-1 border-2 border-slate-700 py-3 rounded-xl font-bold hover:bg-[#2a2f3a] transition touch-button text-white text-sm sm:text-base">
                    Cancelar
                </button>
                <button onclick="confirmarPagamentoFatura()"
                    class="flex-1 btn-primary text-white py-3 rounded-xl font-bold hover:opacity-90 transition touch-button text-sm sm:text-base">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- MODAL PDF -->
    <!-- ============================================ -->
    <div id="modalPDF" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50 p-4">
        <div class="modal-content">
            <h3 class="text-lg sm:text-xl font-black text-white mb-4">üìÑ Gerar Relat√≥rio PDF</h3>

            <div id="conteudoModalPDF" class="mb-6 text-white text-sm sm:text-base"></div>

            <div class="flex flex-col sm:flex-row gap-3">
                <button onclick="fecharModalPDF()"
                    class="flex-1 border-2 border-slate-700 py-3 rounded-xl font-bold hover:bg-[#2a2f3a] transition touch-button text-white text-sm sm:text-base">
                    Cancelar
                </button>
                <button onclick="confirmarGerarPDF()"
                    class="flex-1 btn-primary text-white py-3 rounded-xl font-bold hover:opacity-90 transition touch-button text-sm sm:text-base">
                    Gerar PDF
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // TODO O SEU C√ìDIGO JAVASCRIPT PERMANECE IGUAL
        // ============================================
        const API_URL = "https://script.google.com/macros/s/AKfycbx99AdDg56QB6f1qTgKQeqxLNrgyVasTDNgDvf9XfCvt7NDIuUahSlv2Fs1L2UYI5Zy/exec";

        // Configura√ß√µes Globais
        let usuarioLogado = "";
        let todosOsDados = [];
        let todosOsPagos = [];
        let configuracoesGlobais = {
            salario: 4000,
            cartoes: [
                { nome: "Principal", fechamento: 28, vencimento: 5 },
                { nome: "Secund√°rio", fechamento: 28, vencimento: 5 }
            ]
        };

        let tipoPDFAtual = "";

        // Cores das Categorias
        const CORES_CAT = {
            "Lazer": "bg-amber-100 text-amber-700",
            "Sa√∫de": "bg-rose-100 text-rose-700",
            "Educa√ß√£o": "bg-blue-100 text-blue-700",
            "Aluguel/Fixo": "bg-[#84cc16] text-[#0f1217]",
            "Mercado": "bg-emerald-100 text-emerald-700",
            "Outros": "bg-slate-100 text-slate-700"
        };

        // Cores dos Gr√°ficos
        const CORES_GRAFICOS = {
            categorias: ["#84cc16", "#4d7c0f", "#22c55e", "#16a34a", "#15803d", "#166534", "#14532d"],
            pagamentos: {
                "Cart√£o de Cr√©dito": "#84cc16",
                "Cart√£o de D√©bito": "#4d7c0f",
                "Dinheiro": "#22c55e",
                "PIX": "#16a34a"
            }
        };

        let chartPizza = null;
        let chartBarras = null;
        let chartFormasPagamento = null;

        // ============================================
        // FUN√á√ÉO PARA MOSTRAR/ESCONDER SENHA
        // ============================================
        function toggleSenha() {
            const senhaInput = document.getElementById("inputSenha");
            const toggleBtn = document.getElementById("toggleSenhaBtn");
            const icon = toggleBtn.querySelector("i");

            if (senhaInput.type === "password") {
                senhaInput.type = "text";
                icon.classList.remove("fa-regular", "fa-eye");
                icon.classList.add("fa-regular", "fa-eye-slash");
            } else {
                senhaInput.type = "password";
                icon.classList.remove("fa-regular", "fa-eye-slash");
                icon.classList.add("fa-regular", "fa-eye");
            }
        }

        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================
        window.onload = function () {
            // Preencher data atual
            const hoje = new Date().toISOString().split("T")[0];
            if (document.getElementById("data")) {
                document.getElementById("data").value = hoje;
            }
            if (document.getElementById("modalDataPagamento")) {
                document.getElementById("modalDataPagamento").value = hoje;
            }

            // Verificar login
            if (localStorage.getItem("logadoFinan") === "true") {
                usuarioLogado = localStorage.getItem("userFinan") || "";
                mostrarApp();
            }

            // Carregar configura√ß√µes do localStorage como fallback
            carregarConfiguracoesLocal();

            // Adicionar listener para resize
            window.addEventListener('resize', function () {
                // Redesenhar gr√°ficos se necess√°rio
                if (chartPizza || chartBarras || chartFormasPagamento) {
                    renderizarGraficosComDados(todosOsDados);
                }
            });

            // Garantir que o menu mobile apare√ßa corretamente
            ajustarPaddingBody();
        };

        // Fun√ß√£o para ajustar o padding do body baseado na altura do menu
        function ajustarPaddingBody() {
            if (window.innerWidth <= 768) {
                const menuHeight = document.querySelector('.mobile-bottom-nav')?.offsetHeight || 70;
                document.body.style.paddingBottom = menuHeight + 'px';
            } else {
                document.body.style.paddingBottom = '0';
            }
        }

        // ============================================
        // CARREGAR CONFIGURA√á√ïES DO LOCALSTORAGE (FALLBACK)
        // ============================================
        function carregarConfiguracoesLocal() {
            const salvo = localStorage.getItem("configuracoesFinanWF");
            if (salvo) {
                try {
                    const configLocal = JSON.parse(salvo);
                    if (configLocal.salario) configuracoesGlobais.salario = configLocal.salario;
                    if (configLocal.cartoes && configLocal.cartoes.length > 0) {
                        configuracoesGlobais.cartoes = configLocal.cartoes;
                    }
                } catch (e) { }
            }

            if (document.getElementById("inputSalario")) {
                document.getElementById("inputSalario").value = configuracoesGlobais.salario;
            }

            renderizarConfigCartoes();
            atualizarSelectCartoes();
        }

        // ============================================
        // CARREGAR CONFIGURA√á√ïES DA PLANILHA
        // ============================================
        async function carregarConfiguracoesDaPlanilha() {
            if (!usuarioLogado) return;

            try {
                const url = `${API_URL}?usuario=${encodeURIComponent(usuarioLogado)}&acao=carregarConfiguracoes&_=${Date.now()}`;
                const response = await fetch(url);
                const dados = await response.json();

                if (dados && !dados.erro) {
                    if (dados.salario) {
                        configuracoesGlobais.salario = parseFloat(dados.salario) || 4000;
                    }

                    if (dados.cartoes && Array.isArray(dados.cartoes) && dados.cartoes.length > 0) {
                        configuracoesGlobais.cartoes = dados.cartoes;
                    }

                    localStorage.setItem("configuracoesFinanWF", JSON.stringify(configuracoesGlobais));

                    if (document.getElementById("inputSalario")) {
                        document.getElementById("inputSalario").value = configuracoesGlobais.salario;
                    }

                    renderizarConfigCartoes();
                    atualizarSelectCartoes();
                    atualizarTabela();
                }
            } catch (error) {
                console.error("Erro ao carregar configura√ß√µes da planilha:", error);
            }
        }

        // ============================================
        // SALVAR CONFIGURA√á√ïES NA PLANILHA
        // ============================================
        async function salvarConfiguracoes(event) {
            event.preventDefault();

            const btn = event.target.querySelector('button[type="submit"]');
            const textoOriginal = btn.innerText;

            configuracoesGlobais.salario = parseFloat(document.getElementById("inputSalario").value) || 4000;

            configuracoesGlobais.cartoes.forEach((cartao, index) => {
                const nomeInput = document.getElementById(`cartaoNome_${index}`);
                const fechamentoInput = document.getElementById(`cartaoFechamento_${index}`);
                const vencimentoInput = document.getElementById(`cartaoVencimento_${index}`);

                if (nomeInput) cartao.nome = nomeInput.value || "Cart√£o";
                if (fechamentoInput) cartao.fechamento = parseInt(fechamentoInput.value) || 10;
                if (vencimentoInput) cartao.vencimento = parseInt(vencimentoInput.value) || 15;
            });

            localStorage.setItem("configuracoesFinanWF", JSON.stringify(configuracoesGlobais));

            btn.innerText = "Salvando...";
            btn.disabled = true;

            try {
                await fetch(API_URL, {
                    method: "POST",
                    mode: "no-cors",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        acao: "salvarConfiguracoes",
                        usuario: usuarioLogado,
                        salario: configuracoesGlobais.salario,
                        cartoes: configuracoesGlobais.cartoes
                    })
                });

                alert("‚úÖ Configura√ß√µes salvas com sucesso na planilha!");

                atualizarSelectCartoes();
                atualizarTabela();

            } catch (error) {
                console.error("Erro ao salvar configura√ß√µes:", error);
                alert("‚ùå Erro ao salvar na planilha. As configura√ß√µes foram salvas localmente.");
            } finally {
                btn.innerText = textoOriginal;
                btn.disabled = false;
            }
        }

        // ============================================
        // FUN√á√ïES AUXILIARES DE CONFIGURA√á√ÉO
        // ============================================
        function renderizarConfigCartoes() {
            const container = document.getElementById("containerCartoesConfig");
            if (!container) return;

            let html = "";

            configuracoesGlobais.cartoes.forEach((cartao, index) => {
                html += `
            <div class="border border-slate-700 rounded-xl p-3 sm:p-4">
                <div class="flex justify-between items-center mb-2 sm:mb-3">
                    <input type="text" 
                           id="cartaoNome_${index}" 
                           value="${cartao.nome || 'Cart√£o'}"
                           class="font-bold bg-transparent border-none focus:outline-none focus:ring-2 focus:ring-[#84cc16] rounded-lg p-1 w-32 text-sm sm:text-base touch-button text-white"
                           placeholder="Nome do Cart√£o">
                    <button type="button" onclick="removerCartaoConfig(${index})" class="text-rose-400 text-xs sm:text-sm hover:text-rose-500 p-2 touch-button">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="grid grid-cols-2 gap-3 sm:gap-4">
                    <div>
                        <label class="text-xs font-bold mb-1 block text-slate-400">Fechamento</label>
                        <input type="number" 
                               id="cartaoFechamento_${index}" 
                               value="${cartao.fechamento || 10}"
                               class="w-full border border-slate-700 rounded-lg p-2 text-xs sm:text-sm focus:border-[#84cc16] focus:ring-2 focus:ring-[#84cc16]/20 touch-button bg-[#0f1217] text-white"
                               min="1" max="31">
                    </div>
                    <div>
                        <label class="text-xs font-bold mb-1 block text-slate-400">Vencimento</label>
                        <input type="number" 
                               id="cartaoVencimento_${index}" 
                               value="${cartao.vencimento || 15}"
                               class="w-full border border-slate-700 rounded-lg p-2 text-xs sm:text-sm focus:border-[#84cc16] focus:ring-2 focus:ring-[#84cc16]/20 touch-button bg-[#0f1217] text-white"
                               min="1" max="31">
                    </div>
                </div>
            </div>`;
            });

            container.innerHTML = html;
        }

        function adicionarCartaoConfig() {
            configuracoesGlobais.cartoes.push({
                nome: "Novo Cart√£o",
                fechamento: 10,
                vencimento: 15
            });
            renderizarConfigCartoes();
        }

        function removerCartaoConfig(index) {
            if (configuracoesGlobais.cartoes.length > 1) {
                configuracoesGlobais.cartoes.splice(index, 1);
                renderizarConfigCartoes();
            } else {
                alert("√â necess√°rio manter pelo menos um cart√£o.");
            }
        }

        function atualizarSelectCartoes() {
            const selectCartao = document.getElementById("cartaoSelecionado");
            if (!selectCartao) return;

            selectCartao.innerHTML = "";

            configuracoesGlobais.cartoes.forEach(cartao => {
                const option = document.createElement("option");
                option.value = cartao.nome;
                option.textContent = cartao.nome;
                selectCartao.appendChild(option);
            });
        }

        // ============================================
        // CONTROLE DE TABS
        // ============================================
        function mudarTab(tabId, btn) {
            document.querySelectorAll(".tab-content").forEach(t => t.classList.remove("active"));

            const tabElement = document.getElementById("tab-" + tabId);
            if (tabElement) {
                tabElement.classList.add("active");
            }

            document.querySelectorAll(".sidebar-item").forEach(b => {
                b.classList.remove("active");
            });

            if (btn) {
                btn.classList.add("active");
            }

            document.querySelectorAll('.mobile-bottom-nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.tab === tabId) {
                    item.classList.add('active');
                }
            });

            if (tabId === "dash" || tabId === "vencimentos" || tabId === "historico" || tabId === "cartao") {
                atualizarTabela();
            }
        }

        function mudarTabMobile(tabId) {
            mudarTab(tabId, null);
        }

        // ============================================
        // LOGIN
        // ============================================
        async function verificarSenha() {
            const user = document.getElementById("inputUsuario").value.trim();
            const pass = document.getElementById("inputSenha").value.trim();
            const btn = document.querySelector("#telaLogin button");

            if (!user || !pass) {
                alert("Por favor, preencha todos os campos.");
                return;
            }

            btn.innerText = "Verificando...";
            btn.disabled = true;

            try {
                const url = `${API_URL}?usuario=${encodeURIComponent(user)}&senha=${encodeURIComponent(pass)}&acao=login&_=${Date.now()}`;
                const response = await fetch(url);
                const resultado = await response.json();

                if (resultado.logado) {
                    localStorage.setItem("logadoFinan", "true");
                    localStorage.setItem("userFinan", user);
                    usuarioLogado = user;
                    mostrarApp();
                } else {
                    alert("Usu√°rio ou senha incorretos!");
                    btn.innerText = "Entrar no Sistema";
                    btn.disabled = false;
                }
            } catch (error) {
                console.error("Erro no login:", error);
                alert("Erro de conex√£o. Verifique se o Script foi publicado como 'Qualquer pessoa'.");
                btn.innerText = "Entrar no Sistema";
                btn.disabled = false;
            }
        }

        async function mostrarApp() {
            if (document.getElementById("nomeUsuarioLogado")) {
                document.getElementById("nomeUsuarioLogado").innerText = usuarioLogado;
            }
            document.getElementById("telaLogin").classList.add("hidden");
            document.getElementById("app").classList.remove("hidden");

            await carregarConfiguracoesDaPlanilha();
            atualizarTabela();

            // Ajustar padding ap√≥s mostrar o app
            setTimeout(ajustarPaddingBody, 100);
        }

        function fazerLogout() {
            localStorage.clear();
            usuarioLogado = "";
            todosOsDados = [];
            todosOsPagos = [];
            location.reload();
        }

        // ============================================
        // ATUALIZAR DADOS DA PLANILHA
        // ============================================
        async function atualizarTabela() {
            if (!usuarioLogado) return;

            try {
                const response = await fetch(`${API_URL}?usuario=${encodeURIComponent(usuarioLogado)}&_=${Date.now()}`);
                const dados = await response.json();

                if (dados.erro) {
                    console.error("Erro:", dados.erro);
                    return;
                }

                todosOsDados = Array.isArray(dados) ? dados : [];

                const pendentes = todosOsDados.filter(item =>
                    item.Status === "Pendente" || !item.Status || item.Status === ""
                );
                const pagos = todosOsDados.filter(item =>
                    item.Status === "Pago"
                );
                todosOsPagos = pagos;

                renderizarLinhas(pendentes, "corpoTabelaVencimentos");
                renderizarLinhasPagos(pagos, "corpoTabelaPagos");
                atualizarCardsFinanceiros(pendentes, pagos);
                renderizarGraficosComDados(todosOsDados);

                renderizarFaturasCartao();
                renderizarResumoCartoes();
                renderizarTabelaCartao();

                atualizarBarraProgressoVencimentos();

                const qtdNav = document.getElementById("qtdPendentesNav");
                const qtdSidebar = document.getElementById("qtdPendentes");
                if (qtdNav) qtdNav.innerText = pendentes.length;
                if (qtdSidebar) qtdSidebar.innerText = pendentes.length;

            } catch (err) {
                console.error("Erro ao carregar dados:", err);
            }
        }

        // ============================================
        // RENDERIZAR TABELAS
        // ============================================
        function renderizarLinhas(lista, id) {
            const corpo = document.getElementById(id);
            if (!corpo) return;

            corpo.innerHTML = "";

            if (!lista || lista.length === 0) {
                corpo.innerHTML = `<tr><td colspan="7" class="text-center py-8 text-slate-400 text-sm">Nenhuma conta pendente</td></tr>`;
                return;
            }

            lista.forEach((item) => {
                const idItem = item.ID || item.id || "";
                const descricao = item.Descri√ß√£o || item.Descricao || item.descricao || "Sem descri√ß√£o";
                const categoria = item.Categoria || item.categoria || "Outros";
                const valor = parseFloat(item.Valor || item.valor || 0);
                const dataOriginal = item.Data || item.data || item.Vencimento || "";
                const formaPagamento = item.FormaPagamento || item["Forma Pagamento"] || item.formaPagamento || "N/A";

                let parcela = "1";
                let totalParcelas = "1";

                if (item.ParcelaAtual) parcela = item.ParcelaAtual;
                else if (item.parcelaAtual) parcela = item.parcelaAtual;
                else if (item.Parcela) parcela = item.Parcela;
                else if (item.parcela) parcela = item.parcela;

                if (item.TotalParcelas) totalParcelas = item.TotalParcelas;
                else if (item.totalParcelas) totalParcelas = item.totalParcelas;
                else if (item.Parcelas) totalParcelas = item.Parcelas;
                else if (item.parcelas) totalParcelas = item.parcelas;
                else if (item.Parcelamento) {
                    const partes = item.Parcelamento.toString().split(/[_\/]/);
                    if (partes.length === 2) {
                        parcela = partes[0];
                        totalParcelas = partes[1];
                    }
                }

                let dataFormatada = "---";
                if (dataOriginal) {
                    try {
                        const dataStr = dataOriginal.toString().split("T")[0];
                        if (dataStr.includes("-")) {
                            const [ano, mes, dia] = dataStr.split("-");
                            dataFormatada = `${dia}/${mes}/${ano}`;
                        }
                    } catch (e) { }
                }

                const valorFormatado = valor.toLocaleString("pt-BR", {
                    style: "currency",
                    currency: "BRL"
                });

                const corCategoria = CORES_CAT[categoria] || CORES_CAT["Outros"];

                corpo.innerHTML += `
            <tr>
                <td class="font-mono text-slate-400 text-xs sm:text-sm">${parcela}/${totalParcelas}</td>
                <td class="font-bold text-white text-xs sm:text-sm">${descricao.substring(0, 20)}${descricao.length > 20 ? '...' : ''}</td>
                <td class="hide-on-mobile">
                    <span class="badge badge-info">${formaPagamento}</span>
                </td>
                <td>
                    <span class="badge ${corCategoria}">${categoria}</span>
                </td>
                <td class="text-center font-mono text-white text-xs sm:text-sm">${dataFormatada}</td>
                <td class="text-right font-bold text-[#84cc16] text-xs sm:text-sm">${valorFormatado}</td>
                <td class="text-center">
                    <button onclick="marcarComoPago('${idItem}', event)" 
                            class="action-button">
                        Pagar
                    </button>
                </td>
            </tr>`;
            });
        }

        function renderizarLinhasPagos(lista, id) {
            const corpo = document.getElementById(id);
            if (!corpo) return;

            corpo.innerHTML = "";

            if (!lista || lista.length === 0) {
                corpo.innerHTML = `<tr><td colspan="7" class="text-center py-8 text-slate-400 text-sm">Nenhum registro pago</td></tr>`;
                return;
            }

            lista.forEach((item) => {
                const idItem = item.ID || item.id || "";
                const descricao = item.Descri√ß√£o || item.Descricao || item.descricao || "Sem descri√ß√£o";
                const categoria = item.Categoria || item.categoria || "Outros";
                const valor = parseFloat(item.Valor || item.valor || 0);
                const dataOriginal = item.Data || item.data || item.Vencimento || "";
                const formaPagamento = item.FormaPagamento || item["Forma Pagamento"] || item.formaPagamento || "N/A";

                let parcela = "1";
                let totalParcelas = "1";

                if (item.ParcelaAtual) parcela = item.ParcelaAtual;
                else if (item.parcelaAtual) parcela = item.parcelaAtual;
                else if (item.Parcela) parcela = item.Parcela;
                else if (item.parcela) parcela = item.parcela;

                if (item.TotalParcelas) totalParcelas = item.TotalParcelas;
                else if (item.totalParcelas) totalParcelas = item.totalParcelas;
                else if (item.Parcelas) totalParcelas = item.Parcelas;
                else if (item.parcelas) totalParcelas = item.parcelas;
                else if (item.Parcelamento) {
                    const partes = item.Parcelamento.toString().split(/[_\/]/);
                    if (partes.length === 2) {
                        parcela = partes[0];
                        totalParcelas = partes[1];
                    }
                }

                let dataFormatada = "---";
                if (dataOriginal) {
                    try {
                        const dataStr = dataOriginal.toString().split("T")[0];
                        if (dataStr.includes("-")) {
                            const [ano, mes, dia] = dataStr.split("-");
                            dataFormatada = `${dia}/${mes}/${ano}`;
                        }
                    } catch (e) { }
                }

                const valorFormatado = valor.toLocaleString("pt-BR", {
                    style: "currency",
                    currency: "BRL"
                });

                const corCategoria = CORES_CAT[categoria] || CORES_CAT["Outros"];

                corpo.innerHTML += `
            <tr>
                <td class="font-mono text-slate-400 text-xs sm:text-sm">${parcela}/${totalParcelas}</td>
                <td class="font-bold text-white text-xs sm:text-sm">${descricao.substring(0, 20)}${descricao.length > 20 ? '...' : ''}</td>
                <td class="hide-on-mobile">
                    <span class="badge badge-info">${formaPagamento}</span>
                </td>
                <td>
                    <span class="badge ${corCategoria}">${categoria}</span>
                </td>
                <td class="text-center font-mono text-white text-xs sm:text-sm">${dataFormatada}</td>
                <td class="text-right font-bold text-[#84cc16] text-xs sm:text-sm">${valorFormatado}</td>
                <td class="text-center">
                    <button onclick="estornarRegistro('${idItem}', event)" 
                            class="text-[#84cc16] font-bold text-xs sm:text-sm hover:text-[#4d7c0f] transition hover:underline touch-button">
                        Estornar
                    </button>
                </td>
            </tr>`;
            });
        }

        // ============================================
        // CARDS FINANCEIROS
        // ============================================
        function atualizarCardsFinanceiros(pendentes, pagos) {
            const totalPendente = pendentes.reduce((sum, item) => sum + (parseFloat(item.Valor || item.valor || 0)), 0);
            const totalPago = pagos.reduce((sum, item) => sum + (parseFloat(item.Valor || item.valor || 0)), 0);
            const receitas = configuracoesGlobais.salario || 4000;
            const saldoLivre = receitas - totalPendente - totalPago;

            document.getElementById("cardPendente").innerText = totalPendente.toLocaleString("pt-BR", {
                style: "currency",
                currency: "BRL"
            });

            document.getElementById("cardPago").innerText = totalPago.toLocaleString("pt-BR", {
                style: "currency",
                currency: "BRL"
            });

            document.getElementById("cardReceitas").innerText = receitas.toLocaleString("pt-BR", {
                style: "currency",
                currency: "BRL"
            });

            document.getElementById("cardSaldoRestante").innerText = saldoLivre.toLocaleString("pt-BR", {
                style: "currency",
                currency: "BRL"
            });

            const totalGasto = totalPendente + totalPago;
            const porcentagem = receitas > 0 ? (totalGasto / receitas) * 100 : 0;

            document.getElementById("barraProgresso").style.width = `${Math.min(porcentagem, 100)}%`;
            document.getElementById("txtPorcentagem").innerText = `${porcentagem.toFixed(1)}%`;
        }

        // ============================================
        // GR√ÅFICOS
        // ============================================
        function renderizarGraficosComDados(dados) {
            if (!dados || dados.length === 0) return;

            const resumoCategorias = {};
            const resumoPagamentos = {};

            dados.forEach((item) => {
                const cat = item.Categoria || item.categoria || "Outros";
                const valor = parseFloat(item.Valor || item.valor || 0);
                const forma = item.FormaPagamento || item["Forma Pagamento"] || item.formaPagamento || "Outros";

                resumoCategorias[cat] = (resumoCategorias[cat] || 0) + valor;
                resumoPagamentos[forma] = (resumoPagamentos[forma] || 0) + valor;
            });

            renderizarPizza(resumoCategorias);
            renderizarBarras(resumoCategorias);
            renderizarGraficoPagamentos(resumoPagamentos);
        }

        function renderizarPizza(dados) {
            const canvas = document.getElementById("graficoPizza");
            if (!canvas) return;

            const ctx = canvas.getContext("2d");
            if (chartPizza) chartPizza.destroy();

            const labels = Object.keys(dados);
            const valores = Object.values(dados);

            if (labels.length === 0) {
                labels.push("Sem dados");
                valores.push(1);
            }

            chartPizza = new Chart(ctx, {
                type: "doughnut",
                data: {
                    labels: labels,
                    datasets: [{
                        data: valores,
                        backgroundColor: CORES_GRAFICOS.categorias,
                        borderWidth: 2,
                        borderColor: "#1a1e26"
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: "bottom",
                            labels: {
                                color: "#ffffff",
                                font: {
                                    size: window.innerWidth < 640 ? 10 : 11,
                                    family: "'Inter', sans-serif"
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    const valor = context.raw;
                                    return ` ${context.label}: ${valor.toLocaleString("pt-BR", { style: "currency", currency: "BRL" })}`;
                                }
                            }
                        }
                    },
                    cutout: "70%"
                }
            });
        }

        function renderizarBarras(dados) {
            const canvas = document.getElementById("graficoBarras");
            if (!canvas) return;

            const ctx = canvas.getContext("2d");
            if (chartBarras) chartBarras.destroy();

            const dadosMensais = {};

            todosOsDados.forEach(item => {
                const dataStr = item.Data || item.data || "";
                if (dataStr) {
                    try {
                        const data = new Date(dataStr + "T12:00:00");
                        const mesAno = `${data.getMonth() + 1}/${data.getFullYear()}`;
                        const valor = parseFloat(item.Valor || item.valor || 0);
                        dadosMensais[mesAno] = (dadosMensais[mesAno] || 0) + valor;
                    } catch (e) { }
                }
            });

            const mesesOrdenados = Object.keys(dadosMensais).sort((a, b) => {
                const [mesA, anoA] = a.split("/").map(Number);
                const [mesB, anoB] = b.split("/").map(Number);
                return anoA - anoB || mesA - mesB;
            });

            const nomesMeses = ["Jan", "Fev", "Mar", "Abr", "Mai", "Jun", "Jul", "Ago", "Set", "Out", "Nov", "Dez"];
            const labels = mesesOrdenados.map(mes => {
                const [mesNum, ano] = mes.split("/").map(Number);
                return window.innerWidth < 640 ? nomesMeses[mesNum - 1] : `${nomesMeses[mesNum - 1]}/${ano}`;
            });

            const valores = mesesOrdenados.map(mes => dadosMensais[mes]);

            chartBarras = new Chart(ctx, {
                type: "bar",
                data: {
                    labels: labels,
                    datasets: [{
                        label: "Gastos Mensais",
                        data: valores,
                        backgroundColor: "#84cc16",
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    return `${context.dataset.label}: ${context.parsed.y.toLocaleString("pt-BR", {
                                        style: "currency",
                                        currency: "BRL"
                                    })}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: "#ffffff",
                                font: { size: window.innerWidth < 640 ? 8 : 10 },
                                callback: (value) => `R$ ${value}`
                            },
                            grid: { color: "#2a2f3a" }
                        },
                        x: {
                            ticks: {
                                color: "#ffffff",
                                font: { size: window.innerWidth < 640 ? 8 : 10 }
                            },
                            grid: { color: "#2a2f3a" }
                        }
                    }
                }
            });
        }

        function renderizarGraficoPagamentos(dados) {
            const canvas = document.getElementById("graficoFormasPagamento");
            if (!canvas) return;

            const ctx = canvas.getContext("2d");
            if (chartFormasPagamento) chartFormasPagamento.destroy();

            const labels = Object.keys(dados);
            const valores = Object.values(dados);

            if (labels.length === 0) {
                labels.push("Sem dados");
                valores.push(1);
            }

            const cores = labels.map(label => {
                return CORES_GRAFICOS.pagamentos[label] || "#4b5563";
            });

            chartFormasPagamento = new Chart(ctx, {
                type: "pie",
                data: {
                    labels: labels,
                    datasets: [{
                        data: valores,
                        backgroundColor: cores,
                        borderWidth: 1,
                        borderColor: "#1a1e26"
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: "bottom",
                            labels: {
                                color: "#ffffff",
                                font: {
                                    size: window.innerWidth < 640 ? 10 : 11,
                                    family: "'Inter', sans-serif"
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    const valor = context.raw;
                                    return ` ${context.label}: ${valor.toLocaleString("pt-BR", { style: "currency", currency: "BRL" })}`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // ============================================
        // LAN√áAMENTO DE DESPESAS
        // ============================================
        async function lancar() {
            const btn = document.getElementById("btnLancar");
            const desc = document.getElementById("desc").value.trim();
            const valor = document.getElementById("valor").value.trim();
            const categoria = document.getElementById("categoria").value;
            const data = document.getElementById("data").value;
            const formaPagamento = document.getElementById("formaPagamento").value;
            const parcelas = document.getElementById("parcelas")?.value || "1";
            const cartao = document.getElementById("cartaoSelecionado")?.value || "";

            if (!desc || !valor || !categoria || !data) {
                alert("Preencha todos os campos obrigat√≥rios.");
                return;
            }

            const valorNum = parseFloat(valor);
            const parcelasNum = parseInt(parcelas);

            if (isNaN(valorNum) || valorNum <= 0) {
                alert("Valor inv√°lido!");
                return;
            }

            if (isNaN(parcelasNum) || parcelasNum < 1) {
                alert("N√∫mero de parcelas inv√°lido!");
                return;
            }

            if (parcelasNum > 1) {
                const valorParcela = valorNum / parcelasNum;
                const confirmacao = confirm(
                    `üìã RESUMO DO PARCELAMENTO\n\n` +
                    `Total: R$ ${valorNum.toFixed(2)}\n` +
                    `Parcelas: ${parcelasNum}x\n` +
                    `Valor por parcela: R$ ${valorParcela.toFixed(2)}\n\n` +
                    `Deseja continuar?`
                );

                if (!confirmacao) return;
            }

            btn.innerText = "Enviando...";
            btn.disabled = true;

            try {
                const dados = {
                    acao: "lancar",
                    usuario: usuarioLogado,
                    desc: desc,
                    valor: valorNum.toFixed(2),
                    categoria: categoria,
                    formaPagamento: formaPagamento,
                    data: data,
                    parcelas: parcelasNum,
                    cartao: cartao
                };

                await fetch(API_URL, {
                    method: "POST",
                    mode: "no-cors",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(dados)
                });

                alert(`‚úÖ ${parcelasNum > 1 ? parcelasNum + ' parcelas' : 'Lan√ßamento'} realizado com sucesso!`);
                limparFormLancar();
                await atualizarTabela();

            } catch (err) {
                console.error("Erro ao lan√ßar:", err);
                alert("‚ùå Erro ao salvar. Verifique o console.");
            } finally {
                btn.innerText = "Confirmar Lan√ßamento";
                btn.disabled = false;
            }
        }

        function limparFormLancar() {
            document.getElementById("desc").value = "";
            document.getElementById("valor").value = "";
            document.getElementById("categoria").value = "Aluguel/Fixo";
            document.getElementById("formaPagamento").value = "Cart√£o de Cr√©dito";

            const hoje = new Date().toISOString().split("T")[0];
            document.getElementById("data").value = hoje;

            document.getElementById("parcelas").value = "1";
            toggleCamposCartao();
        }

        // ============================================
        // PAGAMENTO E ESTORNO
        // ============================================
        async function marcarComoPago(id, event) {
            if (!id) {
                alert("ID do registro n√£o encontrado");
                return;
            }

            if (!confirm("Confirmar pagamento desta conta?")) return;

            const btn = event?.target;
            if (btn) {
                btn.innerText = "Pagando...";
                btn.disabled = true;
            }

            try {
                await fetch(API_URL, {
                    method: "POST",
                    mode: "no-cors",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        acao: "pagar",
                        id: id,
                        usuario: usuarioLogado
                    })
                });

                alert("Pagamento registrado!");
                await atualizarTabela();

            } catch (error) {
                console.error("Erro no pagamento:", error);
                alert("Erro ao registrar pagamento.");
            } finally {
                if (btn) {
                    btn.innerText = "Pagar";
                    btn.disabled = false;
                }
            }
        }

        async function estornarRegistro(id, event) {
            if (!id) {
                alert("ID do registro n√£o encontrado");
                return;
            }

            if (!confirm("Tem certeza que deseja estornar este pagamento?")) return;

            const btn = event?.target;
            if (btn) {
                btn.innerText = "Estornando...";
                btn.disabled = true;
                btn.style.opacity = "0.7";
            }

            try {
                await fetch(API_URL, {
                    method: "POST",
                    mode: "no-cors",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        acao: "estornar",
                        id: id,
                        usuario: usuarioLogado
                    })
                });

                alert("Pagamento estornado com sucesso!");
                await atualizarTabela();

            } catch (error) {
                console.error("Erro no estorno:", error);
                alert("Erro ao estornar pagamento.");
            } finally {
                if (btn) {
                    btn.innerText = "Estornar";
                    btn.disabled = false;
                    btn.style.opacity = "1";
                }
            }
        }

        // ============================================
        // CONTROLE DE CART√ÉO DE CR√âDITO
        // ============================================
        function toggleCamposCartao() {
            const formaPagamento = document.getElementById("formaPagamento")?.value;
            const divCartaoInfo = document.getElementById("divCartaoInfo");

            if (!divCartaoInfo) return;

            if (formaPagamento === "Cart√£o de Cr√©dito") {
                divCartaoInfo.style.display = "block";
                atualizarInfoCartao();
            } else {
                divCartaoInfo.style.display = "none";
                document.getElementById("infoFaturaAtual").innerHTML = '<div class="text-slate-400 text-sm">üí∞ Pagamento √† vista</div>';
            }
        }

        function atualizarInfoCartao() {
            const formaPagamento = document.getElementById("formaPagamento")?.value;
            const infoFaturaAtual = document.getElementById("infoFaturaAtual");

            if (!infoFaturaAtual) return;

            if (formaPagamento === "Cart√£o de Cr√©dito") {
                const parcelas = parseInt(document.getElementById("parcelas")?.value) || 1;
                const dataCompra = document.getElementById("data")?.value;
                const cartao = document.getElementById("cartaoSelecionado")?.value || "Principal";
                const valor = parseFloat(document.getElementById("valor")?.value) || 0;

                if (dataCompra && valor > 0) {
                    const faturas = calcularFaturasCartao(dataCompra, parcelas, cartao);
                    const mesesNomes = [
                        "Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho",
                        "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
                    ];

                    if (faturas.length > 0) {
                        const valorParcela = valor / parcelas;

                        let html = `
                    <div class="bg-[#2a2f3a] p-3 rounded-lg">
                        <div class="flex items-center gap-2 text-[#84cc16] text-xs sm:text-sm mb-2">
                            <i class="fas fa-calendar-alt"></i>
                            <span>1¬™ parcela em <strong>${mesesNomes[faturas[0].mes - 1]}</strong></span>
                        </div>`;

                        if (parcelas > 1) {
                            html += `<div class="text-xs space-y-1 text-white">`;
                            for (let i = 0; i < Math.min(parcelas, 3); i++) {
                                const fat = faturas[i];
                                html += `<div class="flex justify-between">
                            <span>Parcela ${i + 1}:</span>
                            <span>${mesesNomes[fat.mes - 1]}</span>
                            <span class="font-bold text-[#84cc16]">R$ ${valorParcela.toFixed(2)}</span>
                        </div>`;
                            }
                            if (parcelas > 3) {
                                html += `<div class="text-center text-[#84cc16] mt-1">+${parcelas - 3} parcelas</div>`;
                            }
                            html += `</div>`;
                        }

                        html += `</div>`;
                        infoFaturaAtual.innerHTML = html;
                    }
                }
            } else {
                infoFaturaAtual.innerHTML = '<div class="text-slate-400 text-sm">üí∞ Pagamento √† vista</div>';
            }
        }

        function calcularFaturasCartao(dataCompra, parcelas, nomeCartao) {
            if (!dataCompra) return [];

            try {
                const cartao = configuracoesGlobais.cartoes.find(c => c.nome === nomeCartao) || configuracoesGlobais.cartoes[0];
                const data = new Date(dataCompra + "T12:00:00");

                if (isNaN(data.getTime())) return [];

                const parcelasNum = parseInt(parcelas) || 1;
                const resultados = [];

                let mesReferencia = data.getMonth();
                let anoReferencia = data.getFullYear();

                const diaFechamento = cartao?.fechamento || 10;

                if (data.getDate() >= diaFechamento) {
                    mesReferencia++;
                    if (mesReferencia > 11) {
                        mesReferencia = 0;
                        anoReferencia++;
                    }
                }

                for (let i = 0; i < parcelasNum; i++) {
                    let mes = mesReferencia + i;
                    let ano = anoReferencia;

                    while (mes > 11) {
                        mes -= 12;
                        ano++;
                    }

                    resultados.push({
                        parcela: i + 1,
                        mes: mes + 1,
                        ano: ano,
                        vencimento: new Date(ano, mes, cartao?.vencimento || 15)
                    });
                }

                return resultados;

            } catch (e) {
                console.error("Erro ao calcular faturas:", e);
                return [];
            }
        }

        // ============================================
        // BARRA DE PROGRESSO
        // ============================================
        function atualizarBarraProgressoVencimentos() {
            const pendentes = todosOsDados.filter(item =>
                item.Status === "Pendente" || !item.Status || item.Status === ""
            );

            const hoje = new Date();
            const mesAtual = hoje.getMonth() + 1;
            const anoAtual = hoje.getFullYear();

            const contasMesAtual = pendentes.filter(item => {
                const dataStr = item.Data || item.data || item.Vencimento || "";
                if (!dataStr) return false;

                try {
                    const data = new Date(dataStr + "T12:00:00");
                    if (isNaN(data.getTime())) return false;
                    return data.getMonth() + 1 === mesAtual && data.getFullYear() === anoAtual;
                } catch (e) {
                    return false;
                }
            });

            const totalMesAtual = contasMesAtual.reduce((sum, item) =>
                sum + (parseFloat(item.Valor || item.valor || 0)), 0
            );

            const pagos = todosOsPagos || [];
            const pagosMesAtual = pagos.filter(item => {
                const dataStr = item.Data || item.data || item.Vencimento || "";
                if (!dataStr) return false;

                try {
                    const data = new Date(dataStr + "T12:00:00");
                    if (isNaN(data.getTime())) return false;
                    return data.getMonth() + 1 === mesAtual && data.getFullYear() === anoAtual;
                } catch (e) {
                    return false;
                }
            });

            const totalPagoMesAtual = pagosMesAtual.reduce((sum, item) =>
                sum + (parseFloat(item.Valor || item.valor || 0)), 0
            );

            const receitaMensal = configuracoesGlobais.salario || 4000;
            const porcentagemGasto = receitaMensal > 0 ? (totalPagoMesAtual / receitaMensal) * 100 : 0;
            const porcentagemExibida = Math.min(porcentagemGasto, 100);

            document.getElementById("totalPendenteMes").innerText = totalMesAtual.toLocaleString("pt-BR", {
                style: "currency",
                currency: "BRL"
            });

            document.getElementById("porcentagemPagaMes").innerText = `${porcentagemExibida.toFixed(1)}%`;
            document.getElementById("barraProgressoVencimentos").style.width = `${porcentagemExibida}%`;

            if (porcentagemGasto >= 90) {
                document.getElementById("barraProgressoVencimentos").style.backgroundColor = "#dc2626";
            } else if (porcentagemGasto >= 70) {
                document.getElementById("barraProgressoVencimentos").style.backgroundColor = "#84cc16";
            } else {
                document.getElementById("barraProgressoVencimentos").style.backgroundColor = "#4d7c0f";
            }
        }

        // ============================================
        // RENDERIZAR FATURAS DO CART√ÉO
        // ============================================
        function renderizarFaturasCartao() {
            const container = document.getElementById("containerFaturas");
            if (!container) return;

            const comprasCartao = todosOsDados.filter(item => {
                const formaPagamento = item.FormaPagamento || item.formaPagamento || "";
                const status = item.Status || "";
                return formaPagamento === "Cart√£o de Cr√©dito" && status !== "Pago";
            });

            const faturasPorMes = {};

            comprasCartao.forEach(item => {
                const dataCompra = item.Data || item.data || "";
                const cartao = item.Cartao || "Principal";
                const valor = parseFloat(item.Valor || item.valor || 0);
                const parcelaAtual = parseInt(item.ParcelaAtual || 1);
                const totalParcelas = parseInt(item.TotalParcelas || 1);

                if (dataCompra && dataCompra !== "" && !isNaN(parcelaAtual) && !isNaN(totalParcelas)) {
                    try {
                        const faturas = calcularFaturasCartao(dataCompra, totalParcelas, cartao);

                        if (faturas && faturas.length > 0 && parcelaAtual <= faturas.length) {
                            const faturaAtual = faturas[parcelaAtual - 1];

                            if (faturaAtual) {
                                const mes = faturaAtual.mes || 1;
                                const ano = faturaAtual.ano || new Date().getFullYear();
                                const chave = `${mes}/${ano}`;

                                if (!faturasPorMes[chave]) {
                                    faturasPorMes[chave] = {};
                                }
                                if (!faturasPorMes[chave][cartao]) {
                                    faturasPorMes[chave][cartao] = 0;
                                }
                                faturasPorMes[chave][cartao] += valor;
                            }
                        }
                    } catch (e) { }
                }
            });

            const mesesNomes = [
                "Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho",
                "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
            ];

            const chavesOrdenadas = Object.keys(faturasPorMes).sort((a, b) => {
                const [mesA, anoA] = a.split("/").map(Number);
                const [mesB, anoB] = b.split("/").map(Number);
                return anoA - anoB || mesA - mesB;
            });

            let html = "";

            if (chavesOrdenadas.length === 0) {
                html = '<div class="text-center py-8 text-slate-400 text-sm">Nenhuma fatura pendente</div>';
            } else {
                chavesOrdenadas.forEach(chave => {
                    const [mes, ano] = chave.split("/").map(Number);
                    const cartoes = faturasPorMes[chave];
                    const totalFatura = Object.values(cartoes).reduce((sum, val) => sum + (val || 0), 0);

                    const nomeMes = !isNaN(mes) && mes >= 1 && mes <= 12 ? mesesNomes[mes - 1] : "M√™s";

                    html += `
                <div class="border border-slate-700 rounded-xl p-3 sm:p-4 hover:shadow-md transition">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold text-white text-sm sm:text-base">${nomeMes}/${ano}</span>
                        <span class="font-bold text-[#84cc16] text-sm sm:text-base">${totalFatura.toLocaleString("pt-BR", { style: "currency", currency: "BRL" })}</span>
                    </div>`;

                    Object.entries(cartoes).forEach(([cartao, valor]) => {
                        html += `
                    <div class="flex justify-between items-center mt-1 text-xs sm:text-sm pl-2 border-l-2 border-[#84cc16]">
                        <span class="text-slate-400">üí≥ ${cartao}</span>
                        <span class="font-medium text-white">${(valor || 0).toLocaleString("pt-BR", { style: "currency", currency: "BRL" })}</span>
                    </div>`;
                    });

                    html += `</div>`;
                });
            }

            container.innerHTML = html;
        }

        function renderizarResumoCartoes() {
            const container = document.getElementById("containerResumoCartoes");
            if (!container) return;

            const comprasCartao = todosOsDados.filter(item =>
                (item.FormaPagamento === "Cart√£o de Cr√©dito" || item.formaPagamento === "Cart√£o de Cr√©dito") &&
                (item.Status !== "Pago")
            );

            const resumo = {};

            comprasCartao.forEach(item => {
                const cartao = item.Cartao || "Principal";
                const valor = parseFloat(item.Valor || item.valor || 0);

                resumo[cartao] = (resumo[cartao] || 0) + valor;
            });

            let html = "";

            Object.entries(resumo).forEach(([cartao, total]) => {
                html += `
            <div class="flex justify-between items-center p-2 sm:p-3 bg-[#2a2f3a] rounded-lg text-xs sm:text-sm">
                <span class="font-bold text-white">${cartao}</span>
                <span class="font-bold text-[#84cc16]">${total.toLocaleString("pt-BR", { style: "currency", currency: "BRL" })}</span>
            </div>`;
            });

            if (Object.keys(resumo).length === 0) {
                html = '<p class="text-slate-400 text-center py-4 text-sm">Nenhum d√©bito no cart√£o</p>';
            }

            container.innerHTML = html;
        }

        function renderizarTabelaCartao() {
            const corpo = document.getElementById("corpoTabelaCartao");
            if (!corpo) return;

            const comprasCartao = todosOsDados.filter(item =>
                (item.FormaPagamento === "Cart√£o de Cr√©dito" || item.formaPagamento === "Cart√£o de Cr√©dito")
            );

            corpo.innerHTML = "";

            if (comprasCartao.length === 0) {
                corpo.innerHTML = `<tr><td colspan="6" class="text-center py-8 text-slate-400 text-sm">Nenhuma compra no cart√£o</td></tr>`;
                return;
            }

            comprasCartao.forEach(item => {
                const descricao = item.Descri√ß√£o || item.Descricao || "Sem descri√ß√£o";
                const cartao = item.Cartao || "Principal";
                const parcelaAtual = item.ParcelaAtual || "1";
                const totalParcelas = item.TotalParcelas || "1";
                const valor = parseFloat(item.Valor || item.valor || 0);
                const status = item.Status || "Pendente";

                const dataOriginal = item.Data || item.data || "";
                let dataFormatada = "---";
                if (dataOriginal) {
                    try {
                        const dataStr = dataOriginal.toString().split("T")[0];
                        if (dataStr.includes("-")) {
                            const [ano, mes, dia] = dataStr.split("-");
                            dataFormatada = `${dia}/${mes}/${ano}`;
                        }
                    } catch (e) { }
                }

                const valorFormatado = valor.toLocaleString("pt-BR", {
                    style: "currency",
                    currency: "BRL"
                });

                corpo.innerHTML += `
            <tr>
                <td class="font-medium text-white text-xs sm:text-sm">${descricao.substring(0, 20)}${descricao.length > 20 ? '...' : ''}</td>
                <td class="hide-on-mobile text-white text-xs sm:text-sm">${cartao}</td>
                <td class="text-white text-xs sm:text-sm">${parcelaAtual}/${totalParcelas}</td>
                <td class="hide-on-mobile text-white text-xs sm:text-sm">${dataFormatada}</td>
                <td class="text-right font-bold text-[#84cc16] text-xs sm:text-sm">${valorFormatado}</td>
                <td class="text-center">
                    <span class="badge ${status === 'Pago' ? 'badge-success' : 'badge-warning'}">
                        ${status === 'Pago' ? 'Pago' : 'Pendente'}
                    </span>
                </td>
            </tr>`;
            });
        }

        // ============================================
        // FUN√á√ïES DO MODAL DE PAGAMENTO DE FATURA
        // ============================================
        function abrirModalPagamentoFatura() {
            const select = document.getElementById("selectFaturaModal");
            select.innerHTML = "";

            const faturas = gerarListaFaturas();

            if (faturas.length === 0) {
                alert("Nenhuma fatura pendente para pagamento.");
                return;
            }

            faturas.forEach((fatura, index) => {
                const option = document.createElement("option");
                option.value = index;
                option.textContent = `${fatura.nomeMes}/${fatura.ano} - ${fatura.cartao} - ${fatura.valor.toLocaleString("pt-BR", { style: "currency", currency: "BRL" })}`;
                option.dataset.valor = fatura.valor;
                option.dataset.mes = fatura.mes;
                option.dataset.ano = fatura.ano;
                option.dataset.cartao = fatura.cartao;
                select.appendChild(option);
            });

            select.onchange = function () {
                const selected = select.options[select.selectedIndex];
                document.getElementById("valorFaturaModal").value = selected.dataset.valor ?
                    parseFloat(selected.dataset.valor).toLocaleString("pt-BR", { style: "currency", currency: "BRL" }) : "R$ 0,00";
            };

            if (faturas.length > 0) {
                select.selectedIndex = 0;
                select.onchange();
            }

            document.getElementById("modalPagamentoFatura").classList.remove("hidden");
            document.getElementById("modalPagamentoFatura").classList.add("flex");
        }

        function fecharModalPagamentoFatura() {
            document.getElementById("modalPagamentoFatura").classList.add("hidden");
            document.getElementById("modalPagamentoFatura").classList.remove("flex");
        }

        function gerarListaFaturas() {
            const comprasCartao = todosOsDados.filter(item =>
                (item.FormaPagamento === "Cart√£o de Cr√©dito" || item.formaPagamento === "Cart√£o de Cr√©dito") &&
                (item.Status !== "Pago")
            );

            const faturasMap = new Map();

            comprasCartao.forEach(item => {
                const dataCompra = item.Data || item.data || "";
                const cartao = item.Cartao || "Principal";
                const valor = parseFloat(item.Valor || item.valor || 0);
                const parcelaAtual = parseInt(item.ParcelaAtual || 1);
                const totalParcelas = parseInt(item.TotalParcelas || 1);

                if (dataCompra && !isNaN(parcelaAtual) && !isNaN(totalParcelas)) {
                    try {
                        const faturas = calcularFaturasCartao(dataCompra, totalParcelas, cartao);

                        if (faturas && faturas.length > 0 && parcelaAtual <= faturas.length) {
                            const faturaAtual = faturas[parcelaAtual - 1];

                            if (faturaAtual) {
                                const mes = faturaAtual.mes;
                                const ano = faturaAtual.ano;
                                const chave = `${mes}/${ano}/${cartao}`;

                                if (faturasMap.has(chave)) {
                                    const existente = faturasMap.get(chave);
                                    existente.valor += valor;
                                } else {
                                    faturasMap.set(chave, {
                                        mes: mes,
                                        ano: ano,
                                        cartao: cartao,
                                        valor: valor,
                                        nomeMes: ["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"][mes - 1]
                                    });
                                }
                            }
                        }
                    } catch (e) { }
                }
            });

            const faturas = Array.from(faturasMap.values());
            faturas.sort((a, b) => {
                if (a.ano !== b.ano) return a.ano - b.ano;
                return a.mes - b.mes;
            });

            return faturas;
        }

        async function confirmarPagamentoFatura() {
            const select = document.getElementById("selectFaturaModal");
            const dataPagamento = document.getElementById("modalDataPagamento").value;

            if (select.selectedIndex === -1) {
                alert("Selecione uma fatura para pagar.");
                return;
            }

            const selectedOption = select.options[select.selectedIndex];
            const mes = selectedOption.dataset.mes;
            const ano = selectedOption.dataset.ano;
            const cartao = selectedOption.dataset.cartao;

            if (!confirm(`Confirmar pagamento da fatura de ${selectedOption.textContent}?`)) return;

            const comprasParaPagar = todosOsDados.filter(item => {
                if (item.Status === "Pago") return false;

                const formaPagamento = item.FormaPagamento || item.formaPagamento || "";
                if (formaPagamento !== "Cart√£o de Cr√©dito") return false;

                if ((item.Cartao || "Principal") !== cartao) return false;

                const dataCompra = item.Data || item.data || "";
                const parcelaAtual = parseInt(item.ParcelaAtual || 1);
                const totalParcelas = parseInt(item.TotalParcelas || 1);

                if (!dataCompra || isNaN(parcelaAtual) || isNaN(totalParcelas)) return false;

                try {
                    const faturas = calcularFaturasCartao(dataCompra, totalParcelas, cartao);
                    if (faturas && faturas.length >= parcelaAtual) {
                        const faturaAtual = faturas[parcelaAtual - 1];
                        return faturaAtual.mes == mes && faturaAtual.ano == ano;
                    }
                } catch (e) { }

                return false;
            });

            if (comprasParaPagar.length === 0) {
                alert("Nenhuma compra encontrada para esta fatura.");
                return;
            }

            const btn = document.querySelector("#modalPagamentoFatura button.bg-\\[\\#1f2937\\]");
            if (btn) {
                btn.innerText = "Processando...";
                btn.disabled = true;
            }

            try {
                for (const compra of comprasParaPagar) {
                    const id = compra.ID || compra.id;
                    if (id) {
                        await fetch(API_URL, {
                            method: "POST",
                            mode: "no-cors",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({
                                acao: "pagar",
                                id: id,
                                usuario: usuarioLogado,
                                dataPagamento: dataPagamento
                            })
                        });
                    }
                }

                alert(`‚úÖ Fatura paga com sucesso! ${comprasParaPagar.length} parcela(s) quitada(s).`);
                fecharModalPagamentoFatura();
                await atualizarTabela();

            } catch (error) {
                console.error("Erro ao pagar fatura:", error);
                alert("‚ùå Erro ao processar pagamento da fatura.");
            } finally {
                if (btn) {
                    btn.innerText = "Confirmar";
                    btn.disabled = false;
                }
            }
        }

        // ============================================
        // FUN√á√ïES DO MODAL PDF
        // ============================================
        function abrirModalPDF(tipo) {
            tipoPDFAtual = tipo;
            const modalContent = document.getElementById("conteudoModalPDF");

            let html = "";

            if (tipo === "vencimentos") {
                html = `
            <h4 class="font-bold mb-4 text-white text-sm sm:text-base">üìä Contas a Pagar</h4>
            <div class="space-y-3">
                <label class="flex items-center p-3 border border-slate-700 rounded-lg cursor-pointer hover:bg-[#2a2f3a] text-white text-sm sm:text-base">
                    <input type="radio" name="pdfOpcao" value="todos" checked class="mr-3 text-[#84cc16]">
                    <span>Todas as contas pendentes</span>
                </label>
                <label class="flex items-center p-3 border border-slate-700 rounded-lg cursor-pointer hover:bg-[#2a2f3a] text-white text-sm sm:text-base">
                    <input type="radio" name="pdfOpcao" value="mesAtual" class="mr-3 text-[#84cc16]">
                    <span>Apenas m√™s atual</span>
                </label>
                <label class="flex items-center p-3 border border-slate-700 rounded-lg cursor-pointer hover:bg-[#2a2f3a] text-white text-sm sm:text-base">
                    <input type="radio" name="pdfOpcao" value="selecionarMes" class="mr-3 text-[#84cc16]">
                    <span>Selecionar m√™s espec√≠fico</span>
                </label>
                <div id="campoMesEspecifico" class="hidden mt-2">
                    <select id="selectMesPDF" class="w-full border border-slate-700 rounded-lg p-3 bg-[#0f1217] text-white text-sm sm:text-base"></select>
                </div>
            </div>
        `;
            } else if (tipo === "historico") {
                html = `
            <h4 class="font-bold mb-4 text-white text-sm sm:text-base">üìú Hist√≥rico de Pagamentos</h4>
            <div class="space-y-3">
                <label class="flex items-center p-3 border border-slate-700 rounded-lg cursor-pointer hover:bg-[#2a2f3a] text-white text-sm sm:text-base">
                    <input type="radio" name="pdfOpcao" value="todos" checked class="mr-3 text-[#84cc16]">
                    <span>Todos os pagamentos</span>
                </label>
                <label class="flex items-center p-3 border border-slate-700 rounded-lg cursor-pointer hover:bg-[#2a2f3a] text-white text-sm sm:text-base">
                    <input type="radio" name="pdfOpcao" value="mesAtual" class="mr-3 text-[#84cc16]">
                    <span>Apenas m√™s atual</span>
                </label>
                <label class="flex items-center p-3 border border-slate-700 rounded-lg cursor-pointer hover:bg-[#2a2f3a] text-white text-sm sm:text-base">
                    <input type="radio" name="pdfOpcao" value="selecionarMes" class="mr-3 text-[#84cc16]">
                    <span>Selecionar m√™s espec√≠fico</span>
                </label>
                <div id="campoMesEspecifico" class="hidden mt-2">
                    <select id="selectMesPDF" class="w-full border border-slate-700 rounded-lg p-3 bg-[#0f1217] text-white text-sm sm:text-base"></select>
                </div>
            </div>
        `;
            } else if (tipo === "cartao") {
                const faturas = gerarListaFaturas();

                if (faturas.length === 0) {
                    html = `<p class="text-center text-slate-400 py-4 text-sm">Nenhuma fatura dispon√≠vel</p>`;
                } else {
                    html = `
                <h4 class="font-bold mb-4 text-white text-sm sm:text-base">üí≥ Faturas do Cart√£o</h4>
                <div class="space-y-3">
                    <label class="flex items-center p-3 border border-slate-700 rounded-lg cursor-pointer hover:bg-[#2a2f3a] text-white text-sm sm:text-base">
                        <input type="radio" name="pdfOpcao" value="todasFaturas" checked class="mr-3 text-[#84cc16]">
                        <span>Todas as faturas</span>
                    </label>
                    <label class="flex items-center p-3 border border-slate-700 rounded-lg cursor-pointer hover:bg-[#2a2f3a] text-white text-sm sm:text-base">
                        <input type="radio" name="pdfOpcao" value="selecionarFatura" class="mr-3 text-[#84cc16]">
                        <span>Selecionar fatura espec√≠fica</span>
                    </label>
                    <div id="campoFaturaEspecifica" class="hidden mt-2">
                        <select id="selectFaturaPDF" class="w-full border border-slate-700 rounded-lg p-3 bg-[#0f1217] text-white text-sm sm:text-base">
            `;

                    faturas.forEach((fatura, index) => {
                        html += `<option value="${index}" class="text-white">${fatura.nomeMes}/${fatura.ano} - ${fatura.cartao} - ${fatura.valor.toLocaleString("pt-BR", { style: "currency", currency: "BRL" })}</option>`;
                    });

                    html += `
                        </select>
                    </div>
                </div>
            `;
                }
            }

            modalContent.innerHTML = html;

            if (tipo === "vencimentos" || tipo === "historico") {
                const radios = document.querySelectorAll('input[name="pdfOpcao"]');
                radios.forEach(radio => {
                    radio.addEventListener('change', function () {
                        const campoMes = document.getElementById("campoMesEspecifico");
                        if (this.value === "selecionarMes") {
                            campoMes.classList.remove("hidden");
                            preencherSelectMeses();
                        } else {
                            campoMes.classList.add("hidden");
                        }
                    });
                });
            } else if (tipo === "cartao" && document.querySelector('input[name="pdfOpcao"]')) {
                const radios = document.querySelectorAll('input[name="pdfOpcao"]');
                radios.forEach(radio => {
                    radio.addEventListener('change', function () {
                        const campoFatura = document.getElementById("campoFaturaEspecifica");
                        if (this.value === "selecionarFatura") {
                            campoFatura.classList.remove("hidden");
                        } else {
                            campoFatura.classList.add("hidden");
                        }
                    });
                });
            }

            document.getElementById("modalPDF").classList.remove("hidden");
            document.getElementById("modalPDF").classList.add("flex");
        }

        function fecharModalPDF() {
            document.getElementById("modalPDF").classList.add("hidden");
            document.getElementById("modalPDF").classList.remove("flex");
            tipoPDFAtual = "";
        }

        function preencherSelectMeses() {
            const select = document.getElementById("selectMesPDF");
            if (!select) return;

            select.innerHTML = "";

            const mesesSet = new Set();

            todosOsDados.forEach(item => {
                const dataStr = item.Data || item.data || item.Vencimento || "";
                if (dataStr) {
                    try {
                        const data = new Date(dataStr + "T12:00:00");
                        const mes = data.getMonth() + 1;
                        const ano = data.getFullYear();
                        mesesSet.add(`${mes}/${ano}`);
                    } catch (e) { }
                }
            });

            const mesesArray = Array.from(mesesSet).sort((a, b) => {
                const [mesA, anoA] = a.split("/").map(Number);
                const [mesB, anoB] = b.split("/").map(Number);
                return anoB - anoA || mesB - mesA;
            });

            const mesesNomes = [
                "Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho",
                "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
            ];

            mesesArray.forEach(mesAno => {
                const [mes, ano] = mesAno.split("/").map(Number);
                const option = document.createElement("option");
                option.value = mesAno;
                option.textContent = `${mesesNomes[mes - 1]}/${ano}`;
                select.appendChild(option);
            });
        }

        function confirmarGerarPDF() {
            const { jsPDF } = window.jspdf;

            if (!jsPDF) {
                alert("Biblioteca jsPDF n√£o carregada. Recarregue a p√°gina.");
                return;
            }

            let dadosParaPDF = [];
            let titulo = "";

            if (tipoPDFAtual === "vencimentos") {
                const opcao = document.querySelector('input[name="pdfOpcao"]:checked')?.value;

                if (opcao === "todos") {
                    dadosParaPDF = todosOsDados.filter(item => item.Status !== "Pago");
                    titulo = "Todas as Contas Pendentes";
                } else if (opcao === "mesAtual") {
                    const hoje = new Date();
                    const mesAtual = hoje.getMonth() + 1;
                    const anoAtual = hoje.getFullYear();

                    dadosParaPDF = todosOsDados.filter(item => {
                        if (item.Status === "Pago") return false;
                        const dataStr = item.Data || item.data || item.Vencimento || "";
                        if (!dataStr) return false;
                        try {
                            const data = new Date(dataStr + "T12:00:00");
                            return data.getMonth() + 1 === mesAtual && data.getFullYear() === anoAtual;
                        } catch (e) {
                            return false;
                        }
                    });
                    titulo = `Contas Pendentes - ${["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"][mesAtual - 1]}/${anoAtual}`;
                } else if (opcao === "selecionarMes") {
                    const select = document.getElementById("selectMesPDF");
                    if (!select) return;

                    const [mes, ano] = select.value.split("/").map(Number);

                    dadosParaPDF = todosOsDados.filter(item => {
                        if (item.Status === "Pago") return false;
                        const dataStr = item.Data || item.data || item.Vencimento || "";
                        if (!dataStr) return false;
                        try {
                            const data = new Date(dataStr + "T12:00:00");
                            return data.getMonth() + 1 === mes && data.getFullYear() === ano;
                        } catch (e) {
                            return false;
                        }
                    });
                    titulo = `Contas Pendentes - ${["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"][mes - 1]}/${ano}`;
                }
            } else if (tipoPDFAtual === "historico") {
                const opcao = document.querySelector('input[name="pdfOpcao"]:checked')?.value;

                if (opcao === "todos") {
                    dadosParaPDF = todosOsPagos;
                    titulo = "Todos os Pagamentos Realizados";
                } else if (opcao === "mesAtual") {
                    const hoje = new Date();
                    const mesAtual = hoje.getMonth() + 1;
                    const anoAtual = hoje.getFullYear();

                    dadosParaPDF = todosOsPagos.filter(item => {
                        const dataStr = item.Data || item.data || item.Vencimento || "";
                        if (!dataStr) return false;
                        try {
                            const data = new Date(dataStr + "T12:00:00");
                            return data.getMonth() + 1 === mesAtual && data.getFullYear() === anoAtual;
                        } catch (e) {
                            return false;
                        }
                    });
                    titulo = `Pagamentos Realizados - ${["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"][mesAtual - 1]}/${anoAtual}`;
                } else if (opcao === "selecionarMes") {
                    const select = document.getElementById("selectMesPDF");
                    if (!select) return;

                    const [mes, ano] = select.value.split("/").map(Number);

                    dadosParaPDF = todosOsPagos.filter(item => {
                        const dataStr = item.Data || item.data || item.Vencimento || "";
                        if (!dataStr) return false;
                        try {
                            const data = new Date(dataStr + "T12:00:00");
                            return data.getMonth() + 1 === mes && data.getFullYear() === ano;
                        } catch (e) {
                            return false;
                        }
                    });
                    titulo = `Pagamentos Realizados - ${["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"][mes - 1]}/${ano}`;
                }
            } else if (tipoPDFAtual === "cartao") {
                const opcao = document.querySelector('input[name="pdfOpcao"]:checked')?.value;

                if (opcao === "todasFaturas") {
                    dadosParaPDF = todosOsDados.filter(item =>
                        (item.FormaPagamento === "Cart√£o de Cr√©dito" || item.formaPagamento === "Cart√£o de Cr√©dito")
                    );
                    titulo = "Todas as Compras no Cart√£o";
                } else if (opcao === "selecionarFatura") {
                    const select = document.getElementById("selectFaturaPDF");
                    if (!select) return;

                    const index = parseInt(select.value);
                    const faturas = gerarListaFaturas();
                    const faturaSelecionada = faturas[index];

                    if (faturaSelecionada) {
                        dadosParaPDF = todosOsDados.filter(item => {
                            if (item.Status === "Pago") return false;

                            const formaPagamento = item.FormaPagamento || item.formaPagamento || "";
                            if (formaPagamento !== "Cart√£o de Cr√©dito") return false;

                            if ((item.Cartao || "Principal") !== faturaSelecionada.cartao) return false;

                            const dataCompra = item.Data || item.data || "";
                            const parcelaAtual = parseInt(item.ParcelaAtual || 1);
                            const totalParcelas = parseInt(item.TotalParcelas || 1);

                            if (!dataCompra || isNaN(parcelaAtual) || isNaN(totalParcelas)) return false;

                            try {
                                const faturas = calcularFaturasCartao(dataCompra, totalParcelas, faturaSelecionada.cartao);
                                if (faturas && faturas.length >= parcelaAtual) {
                                    const faturaAtual = faturas[parcelaAtual - 1];
                                    return faturaAtual.mes == faturaSelecionada.mes && faturaAtual.ano == faturaSelecionada.ano;
                                }
                            } catch (e) { }

                            return false;
                        });

                        titulo = `Fatura - ${faturaSelecionada.nomeMes}/${faturaSelecionada.ano} - ${faturaSelecionada.cartao}`;
                    }
                }
            }

            if (dadosParaPDF.length === 0) {
                alert("Nenhum dado encontrado para o per√≠odo selecionado.");
                fecharModalPDF();
                return;
            }

            gerarPDFComDados(dadosParaPDF, titulo);
            fecharModalPDF();
        }

        function gerarPDFComDados(dados, titulo) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const totalGeral = dados.reduce((sum, item) => sum + (parseFloat(item.Valor || item.valor || 0)), 0);
            const totalPendente = dados.filter(item => item.Status !== "Pago").reduce((sum, item) => sum + (parseFloat(item.Valor || item.valor || 0)), 0);
            const totalPago = dados.filter(item => item.Status === "Pago").reduce((sum, item) => sum + (parseFloat(item.Valor || item.valor || 0)), 0);

            // T√≠tulo
            doc.setFontSize(20);
            doc.setTextColor(132, 204, 22);
            doc.text("FINANWF", 14, 20);

            doc.setFontSize(14);
            doc.setTextColor(255, 255, 255);
            doc.text(titulo, 14, 30);

            doc.setFontSize(10);
            doc.setTextColor(200, 200, 200);
            doc.text(`Gerado em: ${new Date().toLocaleDateString("pt-BR")}`, 14, 38);
            doc.text(`Usu√°rio: ${usuarioLogado}`, 14, 44);

            // Resumo
            doc.setFontSize(12);
            doc.setTextColor(132, 204, 22);
            doc.text("Resumo", 14, 55);

            doc.setFontSize(10);
            doc.setTextColor(255, 255, 255);
            doc.text(`Total Geral: ${totalGeral.toLocaleString("pt-BR", { style: "currency", currency: "BRL" })}`, 20, 63);

            if (totalPendente > 0) {
                doc.text(`Total Pendente: ${totalPendente.toLocaleString("pt-BR", { style: "currency", currency: "BRL" })}`, 20, 70);
            }

            if (totalPago > 0) {
                doc.text(`Total Pago: ${totalPago.toLocaleString("pt-BR", { style: "currency", currency: "BRL" })}`, 20, 77);
            }

            const tableColumn = ["Descri√ß√£o", "Categoria", "Forma", "Vencimento", "Parcelas", "Valor", "Status"];
            const tableRows = [];

            dados.forEach(item => {
                const descricao = item.Descri√ß√£o || item.Descricao || "Sem descri√ß√£o";
                const categoria = item.Categoria || item.categoria || "Outros";
                const forma = item.FormaPagamento || item.formaPagamento || "N/A";
                const data = item.Data || item.data || item.Vencimento || "";
                const valor = parseFloat(item.Valor || item.valor || 0);
                const status = item.Status || "Pendente";

                const parcelaAtual = item.ParcelaAtual || "1";
                const totalParcelas = item.TotalParcelas || "1";
                const parcelas = `${parcelaAtual}/${totalParcelas}`;

                let dataFormatada = data;
                if (data.includes("-")) {
                    const [ano, mes, dia] = data.split("-");
                    dataFormatada = `${dia}/${mes}/${ano}`;
                }

                tableRows.push([
                    descricao.substring(0, 20) + (descricao.length > 20 ? "..." : ""),
                    categoria,
                    forma,
                    dataFormatada,
                    parcelas,
                    valor.toLocaleString("pt-BR", { style: "currency", currency: "BRL" }),
                    status
                ]);
            });

            doc.autoTable({
                startY: 90,
                head: [tableColumn],
                body: tableRows,
                theme: "striped",
                headStyles: { fillColor: [132, 204, 22], textColor: [15, 18, 23] },
                styles: { fontSize: 8, cellPadding: 2, textColor: [255, 255, 255] },
                columnStyles: {
                    0: { cellWidth: 35 },
                    1: { cellWidth: 18 },
                    2: { cellWidth: 18 },
                    3: { cellWidth: 18 },
                    4: { cellWidth: 15 },
                    5: { cellWidth: 22, halign: "right" },
                    6: { cellWidth: 16, halign: "center" }
                }
            });

            const nomeArquivo = `finanwf_${titulo.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().slice(0, 10)}.pdf`;
            doc.save(nomeArquivo);
        }

        // ============================================
        // GARANTIR QUE O MENU FIQUE FIXO
        // ============================================
        function garantirMenuFixo() {
            const menu = document.querySelector('.mobile-bottom-nav');
            if (menu) {
                // Aplicar estilos diretamente via JS para garantir
                menu.style.position = 'fixed';
                menu.style.bottom = '0';
                menu.style.left = '0';
                menu.style.right = '0';
                menu.style.zIndex = '999999';
                menu.style.display = window.innerWidth <= 768 ? 'flex' : 'none';
            }

            // Ajustar padding do body
            if (window.innerWidth <= 768) {
                document.body.style.paddingBottom = '70px';
            } else {
                document.body.style.paddingBottom = '0';
            }
        }

        // Chamar a fun√ß√£o em v√°rios momentos
        window.addEventListener('load', garantirMenuFixo);
        window.addEventListener('resize', garantirMenuFixo);
        window.addEventListener('scroll', garantirMenuFixo);
        document.addEventListener('DOMContentLoaded', garantirMenuFixo);

        // Chamar tamb√©m quando mudar de tab
        setInterval(garantirMenuFixo, 1000); // Verificar a cada segundo para garantir
    </script>

    <style>
        /* Classes utilit√°rias responsivas adicionais */
        @media (max-width: 640px) {
            .hide-mobile {
                display: none;
            }

            .text-responsive {
                font-size: 0.875rem;
            }

            .p-responsive {
                padding: 0.75rem;
            }
        }

        @media (min-width: 641px) and (max-width: 1024px) {
            .text-responsive {
                font-size: 1rem;
            }
        }

        @media (min-width: 1025px) and (max-width: 1920px) {
            .text-responsive {
                font-size: 1.125rem;
            }
        }

        @media (min-width: 1921px) {
            .text-responsive {
                font-size: 1.25rem;
            }
        }

        /* Ajustes para TV */
        @media (min-width: 2560px) {
            .container {
                max-width: 2400px;
            }

            .dashboard-card {
                padding: 2.5rem;
            }

            .badge {
                font-size: 1rem;
                padding: 0.5rem 1.25rem;
            }

            th,
            td {
                padding: 1.5rem;
                font-size: 1.125rem;
            }

            .action-button {
                padding: 0.75rem 1.5rem;
                font-size: 1rem;
            }
        }

        /* Melhorias de toque para mobile */
        @media (max-width: 768px) {

            button,
            .touch-button,
            .sidebar-item {
                min-height: 48px;
                min-width: 48px;
            }

            input,
            select,
            textarea {
                font-size: 16px !important;
                /* Evita zoom autom√°tico no iOS */
            }

            .table-container {
                margin-left: -0.75rem;
                margin-right: -0.75rem;
                width: calc(100% + 1.5rem);
                border-radius: 0;
            }
        }

        /* Esconder elementos espec√≠ficos no mobile */
        @media (max-width: 640px) {
            .hide-on-mobile {
                display: none;
            }
        }

        /* Ajustes para telas muito pequenas */
        @media (max-width: 360px) {
            .dashboard-card .value {
                font-size: 1rem;
            }

            .badge {
                font-size: 0.6rem;
                padding: 0.15rem 0.5rem;
            }

            th,
            td {
                padding: 0.5rem 0.25rem;
                font-size: 0.7rem;
            }
        }

        /* Anima√ß√µes suaves para transi√ß√µes de tamanho */
        * {
            transition: all 0.2s ease-in-out;
        }

        /* Ajustes para impress√£o */
        @media print {

            .mobile-bottom-nav,
            header,
            button,
            .btn-primary,
            .action-button {
                display: none !important;
            }

            body,
            .bg-\[\#0f1217\],
            .bg-\[\#1a1e26\] {
                background-color: white !important;
                color: black !important;
            }

            .text-white,
            .text-\[\#84cc16\] {
                color: black !important;
            }
        }

        /* √öLTIMO RECURSO - FOR√áAR MENU FIXO */
        @media (max-width: 768px) {

            body>.mobile-bottom-nav,
            div.mobile-bottom-nav,
            .mobile-bottom-nav {
                position: fixed !important;
                bottom: 0 !important;
                left: 0 !important;
                right: 0 !important;
                display: flex !important;
                z-index: 999999 !important;
                background: #1a1e26 !important;
                visibility: visible !important;
                opacity: 1 !important;
                pointer-events: auto !important;
            }

            /* Garantir que nada cubra o menu */
            .fixed,
            .sticky,
            [class*="z-"] {
                z-index: auto;
            }

            .mobile-bottom-nav {
                z-index: 999999 !important;
            }
        }

        /* For√ßar menu vis√≠vel mesmo com overflow */
        html,
        body {
            overflow-x: hidden;
            min-height: 100%;
            position: relative;
        }
    </style>


    <script>
        // ============================================
        // REGISTRAR SERVICE WORKER PARA PWA
        // ============================================
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registrado com sucesso: ', registration.scope);
                    })
                    .catch(error => {
                        console.log('Falha ao registrar ServiceWorker: ', error);
                    });
            });
        }

        // ============================================
        // FUN√á√ÉO PARA INSTALAR O APP
        // ============================================
        let deferredPrompt;
        const installButton = document.createElement('button');

        window.addEventListener('beforeinstallprompt', (e) => {
            // Previne que o mini-infobar apare√ßa
            e.preventDefault();
            // Guarda o evento para usar depois
            deferredPrompt = e;

            // Cria bot√£o de instala√ß√£o nas configura√ß√µes
            criarBotaoInstalacao();
        });

        function criarBotaoInstalacao() {
            // Verifica se j√° existe um bot√£o de instala√ß√£o
            if (document.getElementById('btnInstalarPWA')) return;

            // Adiciona bot√£o na tela de configura√ß√µes
            const configContainer = document.getElementById('containerCartoesConfig');
            if (configContainer) {
                const btnInstall = document.createElement('div');
                btnInstall.id = 'btnInstalarPWA';
                btnInstall.className = 'mt-6 pt-4 border-t border-slate-700';
                btnInstall.innerHTML = `
      <button onclick="instalarPWA()" 
              class="w-full bg-[#2a2f3a] text-[#84cc16] py-3 rounded-xl font-bold hover:bg-[#84cc16] hover:text-[#0f1217] transition touch-button flex items-center justify-center gap-2">
        <i class="fas fa-download"></i>
        Instalar App
      </button>
    `;
                configContainer.parentNode.insertBefore(btnInstall, configContainer.nextSibling);
            }
        }

        function instalarPWA() {
            if (!deferredPrompt) {
                alert('Seu navegador j√° tem o app instalado ou n√£o suporta instala√ß√£o autom√°tica.');
                return;
            }

            // Mostra o prompt de instala√ß√£o
            deferredPrompt.prompt();

            // Espera o usu√°rio responder ao prompt
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('Usu√°rio aceitou instalar o app');
                } else {
                    console.log('Usu√°rio recusou instalar o app');
                }
                deferredPrompt = null;
            });
        }

        // Detecta quando o app foi instalado
        window.addEventListener('appinstalled', (evt) => {
            console.log('App foi instalado com sucesso!');
            // Remove o bot√£o de instala√ß√£o
            const btn = document.getElementById('btnInstalarPWA');
            if (btn) btn.remove();
        });




        // ============================================
// VERIFICAR SE O LOGO CARREGOU CORRETAMENTE
// ============================================
function verificarLogos() {
    const logos = document.querySelectorAll('img[src*="assets/logo"]');
    logos.forEach(logo => {
        logo.onerror = function() {
            console.warn('Logo n√£o carregou, usando fallback');
            this.classList.add('error');
            
            // Criar fallback
            const fallback = document.createElement('span');
            fallback.className = 'logo-fallback';
            fallback.textContent = 'üí∞';
            this.parentNode.insertBefore(fallback, this.nextSibling);
        };
        
        logo.onload = function() {
            console.log('Logo carregado com sucesso');
            this.classList.add('logo-image');
        };
    });
}

// Chamar ap√≥s carregar a p√°gina e quando mostrar o app
window.addEventListener('load', verificarLogos);
    </script>

</body>

</html>
